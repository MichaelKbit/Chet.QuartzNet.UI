import{c2 as e,a3 as a,cd as t,c4 as l,cA as o,bs as r}from"./bootstrap.js";import{C as s,P as u,T as i}from"./index34.js";import{F as n}from"./index31.js";import p from"./index6.js";import d from"./index11.js";import m from"./index12.js";import{S as c}from"./SearchOutlined.js";import b from"./index13.js";import y from"./index5.js";import{_ as v}from"./page.vue_vue_type_script_setup_true_lang.js";import{T as j}from"./index25.js";import{a3 as f,L as h,P as x,E as _,ac as N,aj as T,ak as w,al as C,p as g,ab as I,ay as q,f as k,aq as G,F as A,ar as P,ao as L,az as E}from"../app.js";import"./index27.js";import"./shallowequal.js";import"./Trigger.js";import"./ResizeObserver.es.js";import"./_arrayIncludes.js";import"./Overflow.js";import"./BaseInput.js";import"./index28.js";import"./colors.js";import"./collapseMotion.js";import"./slide.js";import"./useRefs.js";import"./responsiveObserve.js";import"./DownOutlined.js";import"./useMergedState.js";import"./EyeOutlined.js";import"./index29.js";import"./index23.js";import"./CheckOutlined.js";import"./move.js";import"./index30.js";import"./index26.js";import"./index3.js";import"./Checkbox.js";import"./FormItemContext.js";import"node:module";import"node:os";import"node:fs";import"node:url";import"node:assert";import"node:process";import"node:path";import"node:v8";import"node:util";import"node:crypto";import"node:tty";import"node:perf_hooks";import"node:vm";import"./index9.js";import"./useFlexGapSupport.js";import"./statusUtils.js";var O=(e=>(e[e.DLL=0]="DLL",e[e.API=1]="API",e))(O||{}),S=(e=>(e[e.Normal=0]="Normal",e[e.Paused=1]="Paused",e[e.Completed=2]="Completed",e[e.Error=3]="Error",e[e.Blocked=4]="Blocked",e))(S||{});async function J(a,t){return await e.post("/api/quartz/PauseJob",null,{params:{jobName:a,jobGroup:t}})}const U=r(f({__name:"job-management",setup(r){const f={[O.DLL]:{text:"DLL",color:"blue"},[O.API]:{text:"API",color:"green"}},U={[S.Normal]:{text:"正常",status:"success"},[S.Paused]:{text:"已暂停",status:"error"},[S.Completed]:{text:"已完成",status:"default"},[S.Error]:{text:"错误",status:"error"},[S.Blocked]:{text:"阻塞",status:"warning"}},z=h(!1),R=h([]),B=h(0),D=h(1),H=h(10),M=h(),$=h({jobName:"",jobGroup:"",status:void 0,jobType:void 0}),F=h(!1),K=h("新增作业"),Q=x({jobName:"",jobGroup:"",jobType:O.CLASS,cronExpression:"",description:"",requestUrl:"",requestMethod:"GET",requestHeaders:"",apiBody:"",assemblyName:"",className:"",methodName:"",paramJson:"",shellCommand:"",apiTimeout:3e4,isActive:!0,retryCount:0,retryInterval:0}),V=h(),W={expandedRowRender:e=>k("div",{style:{padding:"16px",background:"#fafafa"}},[k("div",{style:{marginBottom:"8px"}},[k("strong",null,"描述:")," ",e.description||"-"]),k("div",{style:{marginBottom:"8px"}},[k("strong",null,"创建时间:")," ",e.createTime||"-"]),k("div",{style:{marginBottom:"8px"}},[k("strong",null,"修改时间:")," ",e.updateTime||"-"]),k("div",{style:{display:"flex",gap:"10px",marginTop:"10px"}},[k(a,{type:"link",onClick:()=>ne(e)},"立即执行"),k(a,{type:"link",onClick:()=>ue(e)},"暂停")])])},X=[{title:"作业名称",dataIndex:"jobName",ellipsis:!0},{title:"作业分组",dataIndex:"jobGroup",ellipsis:!0},{title:"作业类型",dataIndex:"jobType",ellipsis:!0,customRender:({record:e})=>{const a=f[e.jobType];return k(j,{color:a?.color||"default"},a?.text||e.jobType||"未知")}},{title:"cron表达式",dataIndex:"cronExpression",ellipsis:!0},{title:"状态",dataIndex:"status",ellipsis:!0,customRender:({record:e})=>{const a=U[e.status];return k(j,{color:a?.status||"default"},a?.text||e.status||"未知")}},{title:"是否启用",dataIndex:"isActive",ellipsis:!0,customRender:({record:e})=>k(b,{checked:e.isActive,disabled:!0})},{title:"上次执行",dataIndex:"lastRunTime",ellipsis:!0},{title:"下次执行",dataIndex:"nextRunTime",ellipsis:!0},{title:"操作",key:"action",width:200,slots:{customRender:"action"}}],Y=_(()=>({current:D.value,pageSize:H.value,total:B.value,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,a)=>`${a[0]}-${a[1]} 共 ${e} 条`,pageSizeOptions:["10","20","50","100"]})),Z=async()=>{z.value=!0;try{const a=await async function(a){return await e.post("/api/quartz/GetJobs",a)}({pageIndex:D.value,pageSize:H.value,jobName:$.value.jobName,jobGroup:$.value.jobGroup,status:$.value.status,jobType:$.value.jobType});R.value=a.data?.items||[],B.value=a.data?.totalCount||0}catch(a){l.error("获取作业列表失败")}finally{z.value=!1}},ee=e=>{D.value=e.current,H.value=e.pageSize,Z()},ae=async()=>{M.value&&await M.value.validateFields(),D.value=1,Z()},te=()=>{$.value={jobName:"",jobGroup:"",jobStatus:void 0,jobType:void 0},D.value=1,Z()},le=()=>{K.value="新增作业",Object.assign(Q,{jobName:"",jobGroup:"",jobType:O.CLASS,cronExpression:"0 0/1 * * * ?",description:"",requestUrl:"",requestMethod:"GET",requestHeaders:"",apiBody:"",assemblyName:"",className:"",methodName:"",paramJson:"",shellCommand:"",apiTimeout:3e4,isActive:!0,retryCount:0,retryInterval:0}),F.value=!0},oe=async a=>{z.value=!0;try{const t=await async function(a,t){return await e.get("/api/quartz/GetJob",{params:{jobName:a,jobGroup:t}})}(a.jobName,a.jobGroup);K.value="编辑作业";const l={jobName:t.result?.jobName||"",jobGroup:t.result?.jobGroup||"",jobType:t.result?.jobType||O.CLASS,cronExpression:t.result?.cronExpression||"",description:t.result?.description||"",requestUrl:t.result?.requestUrl||"",requestMethod:t.result?.requestMethod||"GET",requestHeaders:t.result?.requestHeaders||"",apiBody:t.result?.apiBody||"",assemblyName:t.result?.assemblyName||"",className:t.result?.className||"",methodName:t.result?.methodName||"",paramJson:t.result?.paramJson||"",shellCommand:t.result?.shellCommand||"",apiTimeout:t.result?.apiTimeout||3e4,isActive:!1!==t.result?.isActive,retryCount:t.result?.retryCount||0,retryInterval:t.result?.retryInterval||0};Object.assign(Q,l),F.value=!0}catch(t){l.error("获取作业详情失败")}finally{z.value=!1}},re=async()=>{if(V.value)try{await V.value.validate(),z.value=!0;const a={jobName:Q.jobName,jobGroup:Q.jobGroup,jobType:Q.jobType,cronExpression:Q.cronExpression,description:Q.description,requestUrl:Q.requestUrl,requestMethod:Q.requestMethod,requestHeaders:Q.requestHeaders,apiBody:Q.apiBody,assemblyName:Q.assemblyName,className:Q.className,methodName:Q.methodName,paramJson:Q.paramJson,shellCommand:Q.shellCommand,apiTimeout:Q.apiTimeout,isActive:Q.isActive,retryCount:Q.retryCount,retryInterval:Q.retryInterval};Q.jobName&&Q.jobGroup&&"编辑作业"===K.value?(await async function(a){return await e.put("/api/quartz/UpdateJob",a)}(Q.jobName,Q.jobGroup),l.success("作业更新成功")):(await async function(a){return await e.post("/api/quartz/AddJob",a)}(a),l.success("作业创建成功")),F.value=!1,Z()}catch(a){if(a.errorFields)return;const e=a.response?.data?.message||a.message||("编辑作业"===K.value?"作业更新失败":"作业创建失败");l.error(e)}finally{z.value=!1}},se=async a=>{try{await async function(a,t){return await e.delete("/api/quartz/DeleteJob",{params:{jobName:a,jobGroup:t}})}(a.jobName,a.jobGroup),l.success("作业删除成功"),Z()}catch(t){l.error("作业删除失败")}},ue=async e=>{try{await J(e.jobName,e.jobGroup),l.success("作业暂停成功"),Z()}catch(a){l.error("作业暂停失败")}},ie=async a=>{try{await async function(a,t){return await e.post("/api/quartz/ResumeJob",null,{params:{jobName:a,jobGroup:t}})}(a.jobName,a.jobGroup),l.success("作业恢复成功"),Z()}catch(t){l.error("作业恢复失败")}},ne=async a=>{try{await async function(a,t){return await e.post("/api/quartz/TriggerJob",null,{params:{jobName:a,jobGroup:t}})}(a.jobName,a.jobGroup),l.success("作业立即执行成功"),o.success({message:"作业执行通知",description:`作业 ${a.jobName} 已开始执行，请稍后在日志中查看执行结果`})}catch(t){l.error("作业执行失败")}},pe=()=>{switch(Q.jobType){case O.CLASS:return[{type:"input",label:"程序集名称",name:"assemblyName",placeholder:"请输入程序集名称",required:!0},{type:"input",label:"类名",name:"className",placeholder:"请输入类名（包含命名空间）",required:!0},{type:"input",label:"方法名",name:"methodName",placeholder:"请输入方法名",required:!0},{type:"textarea",label:"参数JSON",name:"paramJson",placeholder:"JSON格式的参数",rows:4}];case O.HTTP:return[{type:"input",label:"请求URL",name:"requestUrl",placeholder:"请输入HTTP请求URL",required:!0},{type:"select",label:"请求方法",name:"requestMethod",options:[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"DELETE",value:"DELETE"}]},{type:"textarea",label:"请求头",name:"requestHeaders",placeholder:'JSON格式的请求头，例如: {"Content-Type": "application/json"}',rows:3},{type:"textarea",label:"API请求体",name:"apiBody",placeholder:"请求体内容",rows:4}];case O.SCRIPT:return[{type:"textarea",label:"脚本命令",name:"shellCommand",placeholder:"请输入要执行的脚本命令",rows:4,required:!0}];default:return[]}};return N(()=>{Z()}),(e,o)=>(w(),T(I(v),null,{default:C(()=>[g(I(s),{style:{"margin-bottom":"20px"}},{default:C(()=>[g(I(n),{ref_key:"searchFormRef",ref:M,model:$.value,layout:"inline","label-col":{span:8},"wrapper-col":{span:16},style:{"flex-wrap":"wrap"}},{default:C(()=>[g(I(n).Item,{label:"作业名称",name:"jobName",style:{"margin-bottom":"16px"}},{default:C(()=>[g(I(p),{placeholder:"请输入作业名称",style:{width:"180px"}})]),_:1}),g(I(n).Item,{label:"作业分组",name:"jobGroup",style:{"margin-bottom":"16px"}},{default:C(()=>[g(I(p),{placeholder:"请输入作业分组",style:{width:"180px"}})]),_:1}),g(I(n).Item,{label:"作业状态",name:"status",style:{"margin-bottom":"16px"}},{default:C(()=>[g(I(d),{placeholder:"请选择状态",allowClear:"",style:{width:"120px"}},{default:C(()=>[g(I(d).Option,{value:I(S).Normal},{default:C(()=>[...o[4]||(o[4]=[q("正常",-1)])]),_:1},8,["value"]),g(I(d).Option,{value:I(S).Paused},{default:C(()=>[...o[5]||(o[5]=[q("已暂停",-1)])]),_:1},8,["value"]),g(I(d).Option,{value:I(S).Completed},{default:C(()=>[...o[6]||(o[6]=[q("已完成",-1)])]),_:1},8,["value"]),g(I(d).Option,{value:I(S).Error},{default:C(()=>[...o[7]||(o[7]=[q("错误",-1)])]),_:1},8,["value"]),g(I(d).Option,{value:I(S).Blocked},{default:C(()=>[...o[8]||(o[8]=[q("阻塞",-1)])]),_:1},8,["value"])]),_:1})]),_:1}),g(I(n).Item,{label:"作业类型",name:"jobType",style:{"margin-bottom":"16px"}},{default:C(()=>[g(I(d),{placeholder:"请选择类型",allowClear:"",style:{width:"120px"}},{default:C(()=>[g(I(d).Option,{value:I(O).DLL},{default:C(()=>[...o[9]||(o[9]=[q("DLL",-1)])]),_:1},8,["value"]),g(I(d).Option,{value:I(O).API},{default:C(()=>[...o[10]||(o[10]=[q("API",-1)])]),_:1},8,["value"])]),_:1})]),_:1}),g(I(n).Item,{style:{"margin-bottom":"16px"}},{default:C(()=>[g(I(m),null,{default:C(()=>[g(I(a),{type:"primary",onClick:ae},{icon:C(()=>[g(I(c))]),default:C(()=>[o[11]||(o[11]=q(" 搜索 ",-1))]),_:1}),g(I(a),{onClick:te},{default:C(()=>[...o[12]||(o[12]=[q(" 重置 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),g(I(s),null,{default:C(()=>[g(I(n).Item,null,{default:C(()=>[g(I(m),{wrap:""},{default:C(()=>[g(I(a),{type:"primary",onClick:le},{icon:C(()=>[g(I(u))]),default:C(()=>[o[13]||(o[13]=q(" 新增作业 ",-1))]),_:1})]),_:1})]),_:1}),g(I(i),{columns:X,"data-source":R.value,pagination:Y.value,loading:z.value,rowKey:e=>`${e.jobName}-${e.jobGroup}`,onChange:ee,expandable:W,size:"middle",width:"100%",tableLayout:"auto"},{action:C(({record:e})=>[g(I(m),null,{default:C(()=>[g(I(a),{type:"primary",disabled:z.value,onClick:a=>oe(e)},{default:C(()=>[...o[14]||(o[14]=[q("编辑",-1)])]),_:1},8,["disabled","onClick"]),g(I(a),{danger:"",disabled:z.value,onClick:a=>se(e)},{default:C(()=>[...o[15]||(o[15]=[q("删除",-1)])]),_:1},8,["disabled","onClick"]),e.status===I(S).Normal?(w(),T(I(a),{key:0,disabled:z.value,onClick:a=>(async e=>{try{await J(e.jobName,e.jobGroup),l.success("作业暂停成功"),Z()}catch(a){l.error("作业暂停失败")}})(e)},{default:C(()=>[...o[16]||(o[16]=[q("停止",-1)])]),_:1},8,["disabled","onClick"])):(w(),T(I(a),{key:1,disabled:z.value,onClick:a=>ie(e)},{default:C(()=>[...o[17]||(o[17]=[q("恢复",-1)])]),_:1},8,["disabled","onClick"]))]),_:2},1024)]),_:1},8,["data-source","pagination","loading","rowKey"])]),_:1}),g(I(t),{visible:F.value,"onUpdate:visible":o[2]||(o[2]=e=>F.value=e),title:K.value,width:"700px",onCancel:o[3]||(o[3]=e=>F.value=!1)},{footer:C(()=>[g(I(m),null,{default:C(()=>[g(I(a),{onClick:o[1]||(o[1]=e=>F.value=!1)},{default:C(()=>[...o[21]||(o[21]=[q("取消",-1)])]),_:1}),g(I(a),{type:"primary",onClick:re},{default:C(()=>[...o[22]||(o[22]=[q("保存",-1)])]),_:1})]),_:1})]),default:C(()=>[g(I(n),{ref_key:"formRef",ref:V,model:Q,layout:"vertical","label-col":{span:6},"wrapper-col":{span:18}},{default:C(()=>[g(I(n).Item,{label:"作业名称",name:"jobName",rules:[{required:!0,message:"请输入作业名称"}]},{default:C(()=>[g(I(p),{placeholder:"请输入作业名称"})]),_:1}),g(I(n).Item,{label:"作业分组",name:"jobGroup",rules:[{required:!0,message:"请输入作业分组"}]},{default:C(()=>[g(I(p),{placeholder:"请输入作业分组"})]),_:1}),g(I(n).Item,{label:"作业类型",name:"jobType",rules:[{required:!0,message:"请选择作业类型"}]},{default:C(()=>[g(I(d),{value:Q.jobType,"onUpdate:value":o[0]||(o[0]=e=>Q.jobType=e),onChange:()=>{}},{default:C(()=>[g(I(d).Option,{value:I(O).DLL},{default:C(()=>[...o[18]||(o[18]=[q("DLL",-1)])]),_:1},8,["value"]),g(I(d).Option,{value:I(O).API},{default:C(()=>[...o[19]||(o[19]=[q("API",-1)])]),_:1},8,["value"])]),_:1},8,["value"])]),_:1}),g(I(n).Item,{label:"Cron表达式",name:"cronExpression",rules:[{required:!0,message:"请输入Cron表达式"}]},{default:C(()=>[g(I(p),{placeholder:"例如: 0 0/1 * * * ? (每分钟执行一次)"})]),_:1}),g(I(n).Item,{label:"描述",name:"description"},{default:C(()=>[g(I(p).TextArea,{placeholder:"请输入作业描述",rows:3})]),_:1}),g(I(n).Item,{label:"API超时(ms)",name:"apiTimeout",rules:[{required:!0,message:"请输入API超时时间"}]},{default:C(()=>[g(I(p),{type:"number",placeholder:"请输入API超时时间，单位毫秒"})]),_:1}),g(I(n).Item,{label:"重试次数",name:"retryCount"},{default:C(()=>[g(I(p),{type:"number",placeholder:"请输入失败重试次数"})]),_:1}),g(I(n).Item,{label:"重试间隔(ms)",name:"retryInterval"},{default:C(()=>[g(I(p),{type:"number",placeholder:"请输入重试间隔时间"})]),_:1}),g(I(n).Item,{label:"是否启用",name:"isActive",valuePropName:"checked"},{default:C(()=>[g(I(b))]),_:1}),g(I(y),null,{default:C(()=>[...o[20]||(o[20]=[q("作业配置详情",-1)])]),_:1}),(w(!0),G(A,null,P(pe(),(e,a)=>(w(),T(I(n).Item,{key:`${e.name}-${a}`,label:e.label,name:e.name,rules:e.required?[{required:!0,message:`请输入${e.label}`}]:[]},{default:C(()=>["input"===e.type?(w(),T(I(p),{key:0,placeholder:e.placeholder},null,8,["placeholder"])):"select"===e.type?(w(),G(A,{key:1},[e.options?(w(),T(I(d),{key:0,value:Q[e.name],"onUpdate:value":a=>Q[e.name]=a},{default:C(()=>[(w(!0),G(A,null,P(e.options,e=>(w(),T(I(d).Option,{key:e.value,value:e.value},{default:C(()=>[q(E(e.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])):L("",!0)],64)):"textarea"===e.type?(w(),T(I(p).TextArea,{key:2,placeholder:e.placeholder,rows:e.rows||3},null,8,["placeholder","rows"])):L("",!0)]),_:2},1032,["label","name","rules"]))),128))]),_:1},8,["model"])]),_:1},8,["visible","title"])]),_:1}))}}),[["__scopeId","data-v-6153e868"]]);export{U as default};
