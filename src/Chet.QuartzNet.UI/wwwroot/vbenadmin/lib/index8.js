import{y as e,P as t,_ as o,z as n,A as i,o as a,g as r,b as l,K as s,B as u,C as d,m as p,p as c,D as f,a as v,f as m,E as g}from"./bootstrap.js";import{T as h}from"./Trigger.js";import{M as b,a as x,S as y,u as S}from"./index27.js";import{a3 as C,N as w,a5 as O,aa as F,p as I,E as P,L as j,P as E,a8 as $,a4 as T,X as k,o as N,V as z,U as B}from"../app.js";import{B as R}from"./BaseInput.js";import{u as A,F as L}from"./FormItemContext.js";import{g as M,a as H}from"./statusUtils.js";import{i as D,g as W,a as V,b as U,e as K,d as X}from"./index26.js";import"./ResizeObserver.es.js";import"./shallowequal.js";import"./_arrayIncludes.js";import"./Overflow.js";import"./index28.js";import"./colors.js";import"./collapseMotion.js";import"./slide.js";import"node:module";import"node:os";import"node:fs";import"node:url";import"node:assert";import"node:process";import"node:path";import"node:v8";import"node:util";import"node:crypto";import"node:tty";import"node:perf_hooks";import"node:vm";function Y(e){return(e||"").toLowerCase()}function _(e,t){const{measureLocation:o,prefix:n,targetText:i,selectionStart:a,split:r}=t;let l=e.slice(0,o);l[l.length-r.length]===r&&(l=l.slice(0,l.length-r.length)),l&&(l=`${l}${r}`);let s=function(e,t,o){const n=e[0];if(!n||n===o)return e;let i=e;const a=t.length;for(let r=0;r<a;r+=1){if(Y(i[r])!==Y(t[r])){i=i.slice(r);break}r===a-1&&(i=i.slice(a))}return i}(e.slice(a),i.slice(a-o-n.length),r);s.slice(0,r.length)===r&&(s=s.slice(r.length));const u=`${l}${n}${i}${r}`;return{text:`${u}${s}`,selectionLocation:u.length}}function G(e,t){let{value:o=""}=t;const n=e.toLowerCase();return-1!==o.toLowerCase().indexOf(n)}const q=Symbol("MentionsContextKey");function J(){}const Q=C({compatConfig:{MODE:3},name:"DropdownMenu",props:{prefixCls:String,options:{type:Array,default:()=>[]}},setup(e,t){let{slots:o}=t;const{activeIndex:n,setActiveIndex:i,selectOption:a,onFocus:r=J,loading:l}=w(q,{activeIndex:O(),loading:O(!1)});let s;const u=e=>{clearTimeout(s),s=setTimeout(()=>{r(e)})};return F(()=>{clearTimeout(s)}),()=>{var t;const{prefixCls:r,options:s}=e,d=s[n.value]||{};return I(b,{prefixCls:`${r}-menu`,activeKey:d.value,onSelect:e=>{let{key:t}=e;const o=s.find(e=>{let{value:o}=e;return o===t});a(o)},onMousedown:u},{default:()=>[!l.value&&s.map((e,t)=>{var n,a;const{value:r,disabled:l,label:s=e.value,class:u,style:d}=e;return I(x,{key:r,disabled:l,onMouseenter:()=>{i(t)},class:u,style:d},{default:()=>[null!==(a=null===(n=o.option)||void 0===n?void 0:n.call(o,e))&&void 0!==a?a:"function"==typeof s?s(e):s]})}),l.value||0!==s.length?null:I(x,{key:"notFoundContent",disabled:!0},{default:()=>[null===(t=o.notFoundContent)||void 0===t?void 0:t.call(o)]}),l.value&&I(x,{key:"loading",disabled:!0},{default:()=>[I(y,{size:"small"},null)]})]})}}}),Z={bottomRight:{points:["tl","br"],offset:[0,4],overflow:{adjustX:0,adjustY:1}},bottomLeft:{points:["tr","bl"],offset:[0,4],overflow:{adjustX:0,adjustY:1}},topRight:{points:["bl","tr"],offset:[0,-4],overflow:{adjustX:0,adjustY:1}},topLeft:{points:["br","tl"],offset:[0,-4],overflow:{adjustX:0,adjustY:1}}},ee=C({compatConfig:{MODE:3},name:"KeywordTrigger",props:{loading:{type:Boolean,default:void 0},options:{type:Array,default:()=>[]},prefixCls:String,placement:String,visible:{type:Boolean,default:void 0},transitionName:String,getPopupContainer:Function,direction:String,dropdownClassName:String},setup(e,t){let{slots:o}=t;const n=()=>`${e.prefixCls}-dropdown`,i=()=>{const{options:t}=e;return I(Q,{prefixCls:n(),options:t},{notFoundContent:o.notFoundContent,option:o.option})},a=P(()=>{const{placement:t,direction:o}=e;let n="topRight";return n="rtl"===o?"top"===t?"topLeft":"bottomLeft":"top"===t?"topRight":"bottomRight",n});return()=>{const{visible:t,transitionName:r,getPopupContainer:l}=e;return I(h,{prefixCls:n(),popupVisible:t,popup:i(),popupClassName:e.dropdownClassName,popupPlacement:a.value,popupTransitionName:r,builtinPlacements:Z,getPopupContainer:l},{default:o.default})}}}),te=n("top","bottom"),oe={autofocus:{type:Boolean,default:void 0},prefix:t.oneOfType([t.string,t.arrayOf(t.string)]),prefixCls:String,value:String,disabled:{type:Boolean,default:void 0},split:String,transitionName:String,placement:t.oneOf(te),character:t.any,characterRender:Function,filterOption:{type:[Boolean,Function]},validateSearch:Function,getPopupContainer:{type:Function},options:e(),loading:{type:Boolean,default:void 0},rows:[Number,String],direction:{type:String}},ne=o(o({},oe),{dropdownClassName:String}),ie={prefix:"@",split:" ",rows:1,validateSearch:function(e,t){const{split:o}=t;return!o||-1===e.indexOf(o)},filterOption:()=>G};i(ne,ie);var ae=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(o[n[i]]=e[n[i]])}return o};function re(){}const le=C({compatConfig:{MODE:3},name:"Mentions",inheritAttrs:!1,props:i(ne,ie),emits:["change","select","search","focus","blur","pressenter"],setup(e,t){let{emit:n,attrs:i,expose:u,slots:d}=t;const p=j(null),c=j(null),f=j(),v=E({value:e.value||"",measuring:!1,measureLocation:0,measureText:null,measurePrefix:"",activeIndex:0,isFocus:!1});$(()=>{v.value=e.value});const m=e=>{n("change",e)},g=e=>{let{target:{value:t}}=e;m(t)},h=e=>{o(v,{measuring:!1,measureLocation:0,measureText:null}),null==e||e()},b=e=>{const{which:t}=e;if(v.measuring)if(t===s.UP||t===s.DOWN){const o=A.value.length,n=t===s.UP?-1:1,i=(v.activeIndex+n+o)%o;v.activeIndex=i,e.preventDefault()}else if(t===s.ESC)h();else if(t===s.ENTER){if(e.preventDefault(),!A.value.length)return void h();const t=A.value[v.activeIndex];F(t)}},x=t=>{const{key:i,which:a}=t,{measureText:r,measuring:l}=v,{prefix:u,validateSearch:d}=e,p=t.target;if(p.composing)return;const c=function(e){const{selectionStart:t}=e;return e.value.slice(0,t)}(p),{location:f,prefix:m}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(Array.isArray(t)?t:[t]).reduce((t,o)=>{const n=e.lastIndexOf(o);return n>t.location?{location:n,prefix:o}:t},{location:-1,prefix:""})}(c,u);if(-1===[s.ESC,s.UP,s.DOWN,s.ENTER].indexOf(a))if(-1!==f){const t=c.slice(f+m.length),a=d(t,e),s=!!B(t).length;a?(i===m||"Shift"===i||l||t!==r&&s)&&((e,t,n)=>{o(v,{measuring:!0,measureText:e,measurePrefix:t,measureLocation:n,activeIndex:0})})(t,m,f):l&&h(),a&&n("search",t,m)}else l&&h()},y=e=>{v.measuring||n("pressenter",e)},S=e=>{w(e)},C=e=>{O(e)},w=e=>{clearTimeout(f.value);const{isFocus:t}=v;!t&&e&&n("focus",e),v.isFocus=!0},O=e=>{f.value=setTimeout(()=>{v.isFocus=!1,h(),n("blur",e)},100)},F=t=>{const{split:o}=e,{value:i=""}=t,{text:a,selectionLocation:r}=_(v.value,{measureLocation:v.measureLocation,targetText:i,prefix:v.measurePrefix,selectionStart:c.value.getSelectionStart(),split:o});m(a),h(()=>{var e,t;e=c.value.input,t=r,e.setSelectionRange(t,t),e.blur(),e.focus()}),n("select",t,v.measurePrefix)},B=t=>{const o=t||v.measureText||"",{filterOption:n}=e;return e.options.filter(e=>!1==!!n||n(o,e))},A=P(()=>B());return u({blur:()=>{c.value.blur()},focus:()=>{c.value.focus()}}),T(q,{activeIndex:k(v,"activeIndex"),setActiveIndex:e=>{v.activeIndex=e},selectOption:F,onFocus:w,onBlur:O,loading:k(e,"loading")}),N(()=>{z(()=>{v.measuring&&(p.value.scrollTop=c.value.getScrollTop())})}),()=>{const{measureLocation:t,measurePrefix:n,measuring:s}=v,{prefixCls:u,placement:f,transitionName:m,getPopupContainer:h,direction:w}=e,O=ae(e,["prefixCls","placement","transitionName","getPopupContainer","direction"]),{class:F,style:P}=i,j=ae(i,["class","style"]),E=a(O,["value","prefix","split","validateSearch","filterOption","options","loading"]),$=o(o(o({},E),j),{onChange:re,onSelect:re,value:v.value,onInput:g,onBlur:C,onKeydown:b,onKeyup:x,onFocus:S,onPressenter:y});return I("div",{class:r(u,F),style:P},[I(R,l(l({},$),{},{ref:c,tag:"textarea"}),null),s&&I("div",{ref:p,class:`${u}-measure`},[v.value.slice(0,t),I(ee,{prefixCls:u,transitionName:m,dropdownClassName:e.dropdownClassName,placement:f,options:s?A.value:[],visible:!0,direction:w,getPopupContainer:h},{default:()=>[I("span",null,[n])],notFoundContent:d.notFoundContent,option:d.option}),v.value.slice(t+n.length)])])}}}),se={value:String,disabled:Boolean,payload:u()},ue=o(o({},se),{label:d([])}),de={name:"Option",props:ue,render(e,t){let{slots:o}=t;var n;return null===(n=o.default)||void 0===n?void 0:n.call(o)}};C(o({compatConfig:{MODE:3}},de));const pe=e=>{const{componentCls:t,colorTextDisabled:n,controlItemBgHover:i,controlPaddingHorizontal:a,colorText:r,motionDurationSlow:l,lineHeight:s,controlHeight:u,inputPaddingHorizontal:d,inputPaddingVertical:p,fontSize:v,colorBgElevated:m,borderRadiusLG:g,boxShadowSecondary:h}=e,b=Math.round((e.controlHeight-e.fontSize*e.lineHeight)/2);return{[t]:o(o(o(o(o({},c(e)),W(e)),{position:"relative",display:"inline-block",height:"auto",padding:0,overflow:"hidden",lineHeight:s,whiteSpace:"pre-wrap",verticalAlign:"bottom"}),V(e,t)),{"&-disabled":{"> textarea":o({},X(e))},"&-focused":o({},K(e)),[`&-affix-wrapper ${t}-suffix`]:{position:"absolute",top:0,insetInlineEnd:d,bottom:0,zIndex:1,display:"inline-flex",alignItems:"center",margin:"auto"},[`> textarea, ${t}-measure`]:{color:r,boxSizing:"border-box",minHeight:u-2,margin:0,padding:`${p}px ${d}px`,overflow:"inherit",overflowX:"hidden",overflowY:"auto",fontWeight:"inherit",fontSize:"inherit",fontFamily:"inherit",fontStyle:"inherit",fontVariant:"inherit",fontSizeAdjust:"inherit",fontStretch:"inherit",lineHeight:"inherit",direction:"inherit",letterSpacing:"inherit",whiteSpace:"inherit",textAlign:"inherit",verticalAlign:"top",wordWrap:"break-word",wordBreak:"inherit",tabSize:"inherit"},"> textarea":o({width:"100%",border:"none",outline:"none",resize:"none",backgroundColor:"inherit"},U(e.colorTextPlaceholder)),[`${t}-measure`]:{position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,zIndex:-1,color:"transparent",pointerEvents:"none","> span":{display:"inline-block",minHeight:"1em"}},"&-dropdown":o(o({},c(e)),{position:"absolute",top:-9999,insetInlineStart:-9999,zIndex:e.zIndexPopup,boxSizing:"border-box",fontSize:v,fontVariant:"initial",backgroundColor:m,borderRadius:g,outline:"none",boxShadow:h,"&-hidden":{display:"none"},[`${t}-dropdown-menu`]:{maxHeight:e.dropdownHeight,marginBottom:0,paddingInlineStart:0,overflow:"auto",listStyle:"none",outline:"none","&-item":o(o({},f),{position:"relative",display:"block",minWidth:e.controlItemWidth,padding:`${b}px ${a}px`,color:r,fontWeight:"normal",lineHeight:s,cursor:"pointer",transition:`background ${l} ease`,"&:hover":{backgroundColor:i},"&:first-child":{borderStartStartRadius:g,borderStartEndRadius:g,borderEndStartRadius:0,borderEndEndRadius:0},"&:last-child":{borderStartStartRadius:0,borderStartEndRadius:0,borderEndStartRadius:g,borderEndEndRadius:g},"&-disabled":{color:n,cursor:"not-allowed","&:hover":{color:n,backgroundColor:i,cursor:"not-allowed"}},"&-selected":{color:r,fontWeight:e.fontWeightStrong,backgroundColor:i},"&-active":{backgroundColor:i}})}})})}},ce=p("Mentions",e=>{const t=D(e);return[pe(t)]},e=>({dropdownHeight:250,controlItemWidth:100,zIndexPopup:e.zIndexPopupBase+50}));var fe=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(o[n[i]]=e[n[i]])}return o};function ve(){return!0}const me=()=>o(o({},oe),{loading:{type:Boolean,default:void 0},onFocus:{type:Function},onBlur:{type:Function},onSelect:{type:Function},onChange:{type:Function},onPressenter:{type:Function},"onUpdate:value":{type:Function},notFoundContent:t.any,defaultValue:String,id:String,status:String}),ge=C({compatConfig:{MODE:3},name:"AMentions",inheritAttrs:!1,props:me(),slots:Object,setup(e,t){let{slots:n,emit:i,attrs:s,expose:u}=t;var d,p;const{prefixCls:c,renderEmpty:f,direction:h}=v("mentions",e),[b,x]=ce(c),C=O(!1),w=O(null),F=O(null!==(p=null!==(d=e.value)&&void 0!==d?d:e.defaultValue)&&void 0!==p?p:""),j=A(),E=L.useInject(),$=P(()=>M(E.status,e.status));S({prefixCls:P(()=>`${c.value}-menu`),mode:P(()=>"vertical"),selectable:P(()=>!1),onClick:()=>{},validator:e=>{let{mode:t}=e}}),B(()=>e.value,e=>{F.value=e});const T=e=>{C.value=!0,i("focus",e)},k=e=>{C.value=!1,i("blur",e),j.onFieldBlur()},N=function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];i("select",...t),C.value=!0},z=t=>{void 0===e.value&&(F.value=t),i("update:value",t),i("change",t),j.onFieldChange()},R=()=>{const t=e.notFoundContent;return void 0!==t?t:n.notFoundContent?n.notFoundContent():f("Select")};u({focus:()=>{w.value.focus()},blur:()=>{w.value.blur()}});const D=P(()=>e.loading?ve:e.filterOption);return()=>{const{disabled:t,getPopupContainer:i,rows:u=1,id:d=j.id.value}=e,p=fe(e,["disabled","getPopupContainer","rows","id"]),{hasFeedback:f,feedbackIcon:v}=E,{class:S}=s,O=fe(s,["class"]),P=a(p,["defaultValue","onUpdate:value","prefixCls"]),B=r({[`${c.value}-disabled`]:t,[`${c.value}-focused`]:C.value,[`${c.value}-rtl`]:"rtl"===h.value},H(c.value,$.value),!f&&S,x.value),A=o(o(o(o({prefixCls:c.value},P),{disabled:t,direction:h.value,filterOption:D.value,getPopupContainer:i,options:e.loading?[{value:"ANTDV_SEARCHING",disabled:!0,label:I(y,{size:"small"},null)}]:e.options||m((null===(L=n.default)||void 0===L?void 0:L.call(n))||[]).map(e=>{var t,n;return o(o({},g(e)),{label:null===(n=null===(t=e.children)||void 0===t?void 0:t.default)||void 0===n?void 0:n.call(t)})}),class:B}),O),{rows:u,onChange:z,onSelect:N,onFocus:T,onBlur:k,ref:w,value:F.value,id:d});var L;const M=I(le,l(l({},A),{},{dropdownClassName:x.value}),{notFoundContent:R,option:n.option});return b(f?I("div",{class:r(`${c.value}-affix-wrapper`,H(`${c.value}-affix-wrapper`,$.value,f),S,x.value)},[M,I("span",{class:`${c.value}-suffix`},[v])]):M)}}}),he=C(o(o({compatConfig:{MODE:3}},de),{name:"AMentionsOption",props:ue})),be=o(ge,{Option:he,getMentions:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{prefix:o="@",split:n=" "}=t,i=Array.isArray(o)?o:[o];return e.split(n).map(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=null;return i.some(o=>e.slice(0,o.length)===o&&(t=o,!0)),null!==t?{prefix:t,value:e.slice(t.length)}:null}).filter(e=>!!e&&!!e.value)},install:e=>(e.component(ge.name,ge),e.component(he.name,he),e)});export{he as MentionsOption,be as default,me as mentionsProps};
