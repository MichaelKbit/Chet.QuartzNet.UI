var e=(e,l,a)=>new Promise((t,o)=>{var r=e=>{try{s(a.next(e))}catch(l){o(l)}},u=e=>{try{s(a.throw(e))}catch(l){o(l)}},s=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,u);s((a=a.apply(e,l)).next())});import{c4 as l,a1 as a,cf as t,c6 as o,cC as r,bu as u}from"./bootstrap-Dknk63fm.js";import{C as s,T as n}from"./index-DBvb-sfc.js";import{F as i}from"./index-C2Eo83Wa.js";import d from"./index-DOvWlsNm.js";import p from"./index-VzuCWjo3.js";import m from"./index-BBW3qyQk.js";import c from"./index-2WpKTNj9.js";import v from"./index-C9KQxjWc.js";import{_ as b}from"./page.vue_vue_type_script_setup_true_lang-QI_gjHfp.js";import{T as y}from"./index-DZNw7q88.js";import{a1 as j,L as f,P as h,E as x,aa as _,ai as N,aj as T,ak as C,p as g,a9 as I,ax as q,f as k,ap as w,F as G,aq as A,an as P,ay as L}from"../jse/index-index-BjsohvV2.js";import"./index-Sx0HnbcD.js";import"./shallowequal-DLcJdWKo.js";import"./Trigger-CXz1cCLg.js";import"./ResizeObserver.es-C7U_o75s.js";import"./_arrayIncludes-DqeOlflt.js";import"./Overflow-urvnm9fc.js";import"./BaseInput-T7L4Ldnl.js";import"./index-CtWXssZO.js";import"./colors-D0MC-0ns.js";import"./collapseMotion-RTOK8HE6.js";import"./slide-JMGE-Bzl.js";import"./useRefs-Eh8g9u0z.js";import"./responsiveObserve-s3fVQGzo.js";import"./DownOutlined-pnwHLwTR.js";import"./useMergedState-vo45-IH8.js";import"./EyeOutlined-Dakt5ugR.js";import"./index-C_zS9hMd.js";import"./index-aHQwyLfN.js";import"./CheckOutlined-BWowORdV.js";import"./SearchOutlined-DFzxISE2.js";import"./move-u3owcrgg.js";import"./index-CRnfpFay.js";import"./index-B-4VqaYf.js";import"./index-DPUBbvAb.js";import"./Checkbox-DGSPHwOQ.js";import"./FormItemContext-Cb8CZKYg.js";import"./index-C5ldlT8a.js";import"./useFlexGapSupport-C4pCnLjJ.js";import"./statusUtils-_fffg90x.js";var E=(e=>(e[e.DLL=0]="DLL",e[e.API=1]="API",e))(E||{}),O=(e=>(e[e.Normal=0]="Normal",e[e.Paused=1]="Paused",e[e.Completed=2]="Completed",e[e.Error=3]="Error",e[e.Blocked=4]="Blocked",e))(O||{});function S(a,t){return e(this,null,function*(){return yield l.post("/api/quartz/PauseJob",null,{params:{jobName:a,jobGroup:t}})})}const J=u(j({__name:"job-management",setup(u){const j={[E.DLL]:{text:"DLL",color:"blue"},[E.API]:{text:"API",color:"green"}},J={[O.Normal]:{text:"正常",status:"success"},[O.Paused]:{text:"已暂停",status:"error"},[O.Completed]:{text:"已完成",status:"default"},[O.Error]:{text:"错误",status:"error"},[O.Blocked]:{text:"阻塞",status:"warning"}},U=f(!1),R=f([]),z=f(0),B=f(1),D=f(10),$=f(),H=f({jobName:"",jobGroup:"",status:void 0,jobType:void 0}),M=f(!1),F=f("新增作业"),K=h({jobName:"",jobGroup:"",jobType:E.CLASS,cronExpression:"",description:"",requestUrl:"",requestMethod:"GET",requestHeaders:"",apiBody:"",assemblyName:"",className:"",methodName:"",paramJson:"",shellCommand:"",apiTimeout:3e4,isActive:!0,retryCount:0,retryInterval:0}),Q=f(),V={expandedRowRender:e=>k("div",{style:{padding:"16px",background:"#fafafa"}},[k("div",{style:{marginBottom:"8px"}},[k("strong",null,"描述:")," ",e.description||"-"]),k("div",{style:{marginBottom:"8px"}},[k("strong",null,"创建时间:")," ",e.createTime||"-"]),k("div",{style:{marginBottom:"8px"}},[k("strong",null,"修改时间:")," ",e.updateTime||"-"]),k("div",{style:{display:"flex",gap:"10px",marginTop:"10px"}},[k(a,{type:"link",onClick:()=>ne(e)},"立即执行"),k(a,{type:"link",onClick:()=>ue(e)},"暂停")])])},W=[{title:"作业名称",dataIndex:"jobName",ellipsis:!0},{title:"作业分组",dataIndex:"jobGroup",ellipsis:!0},{title:"作业类型",dataIndex:"jobType",ellipsis:!0,customRender:({record:e})=>{const l=j[e.jobType];return k(y,{color:(null==l?void 0:l.color)||"default"},(null==l?void 0:l.text)||e.jobType||"未知")}},{title:"cron表达式",dataIndex:"cronExpression",ellipsis:!0},{title:"状态",dataIndex:"status",ellipsis:!0,customRender:({record:e})=>{const l=J[e.status];return k(y,{color:(null==l?void 0:l.status)||"default"},(null==l?void 0:l.text)||e.status||"未知")}},{title:"是否启用",dataIndex:"isActive",ellipsis:!0,customRender:({record:e})=>k(c,{checked:e.isActive,disabled:!0})},{title:"上次执行",dataIndex:"lastRunTime",ellipsis:!0},{title:"下次执行",dataIndex:"nextRunTime",ellipsis:!0},{title:"操作",key:"action",width:200,slots:{customRender:"action"}}],X=x(()=>({current:B.value,pageSize:D.value,total:z.value,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,l)=>`${l[0]}-${l[1]} 共 ${e} 条`,pageSizeOptions:["10","20","50","100"]})),Y=()=>e(null,null,function*(){var a,t;U.value=!0;try{const o=yield function(a){return e(this,null,function*(){return yield l.post("/api/quartz/GetJobs",a)})}({pageIndex:B.value,pageSize:D.value,jobName:H.value.jobName,jobGroup:H.value.jobGroup,status:H.value.status,jobType:H.value.jobType});R.value=(null==(a=o.data)?void 0:a.items)||[],z.value=(null==(t=o.data)?void 0:t.totalCount)||0}catch(r){o.error("获取作业列表失败"),console.error("获取作业列表失败:",r)}finally{U.value=!1}}),Z=e=>{B.value=e.current,D.value=e.pageSize,Y()},ee=()=>e(null,null,function*(){$.value&&(yield $.value.validateFields()),B.value=1,Y()}),le=()=>{H.value={jobName:"",jobGroup:"",jobStatus:void 0,jobType:void 0},B.value=1,Y()},ae=()=>{F.value="新增作业",Object.assign(K,{jobName:"",jobGroup:"",jobType:E.CLASS,cronExpression:"0 0/1 * * * ?",description:"",requestUrl:"",requestMethod:"GET",requestHeaders:"",apiBody:"",assemblyName:"",className:"",methodName:"",paramJson:"",shellCommand:"",apiTimeout:3e4,isActive:!0,retryCount:0,retryInterval:0}),M.value=!0},te=a=>e(null,null,function*(){var t,r,u,s,n,i,d,p,m,c,v,b,y,j,f,h,x,_;U.value=!0;try{const o=yield function(a,t){return e(this,null,function*(){return yield l.get("/api/quartz/GetJob",{params:{jobName:a,jobGroup:t}})})}(a.jobName,a.jobGroup);F.value="编辑作业";const N={jobName:(null==(t=o.result)?void 0:t.jobName)||"",jobGroup:(null==(r=o.result)?void 0:r.jobGroup)||"",jobType:(null==(u=o.result)?void 0:u.jobType)||E.CLASS,cronExpression:(null==(s=o.result)?void 0:s.cronExpression)||"",description:(null==(n=o.result)?void 0:n.description)||"",requestUrl:(null==(i=o.result)?void 0:i.requestUrl)||"",requestMethod:(null==(d=o.result)?void 0:d.requestMethod)||"GET",requestHeaders:(null==(p=o.result)?void 0:p.requestHeaders)||"",apiBody:(null==(m=o.result)?void 0:m.apiBody)||"",assemblyName:(null==(c=o.result)?void 0:c.assemblyName)||"",className:(null==(v=o.result)?void 0:v.className)||"",methodName:(null==(b=o.result)?void 0:b.methodName)||"",paramJson:(null==(y=o.result)?void 0:y.paramJson)||"",shellCommand:(null==(j=o.result)?void 0:j.shellCommand)||"",apiTimeout:(null==(f=o.result)?void 0:f.apiTimeout)||3e4,isActive:!1!==(null==(h=o.result)?void 0:h.isActive),retryCount:(null==(x=o.result)?void 0:x.retryCount)||0,retryInterval:(null==(_=o.result)?void 0:_.retryInterval)||0};Object.assign(K,N),M.value=!0}catch(N){o.error("获取作业详情失败"),console.error("获取作业详情失败:",N)}finally{U.value=!1}}),oe=()=>e(null,null,function*(){var a,t;if(Q.value)try{yield Q.value.validate(),U.value=!0;const a={jobName:K.jobName,jobGroup:K.jobGroup,jobType:K.jobType,cronExpression:K.cronExpression,description:K.description,requestUrl:K.requestUrl,requestMethod:K.requestMethod,requestHeaders:K.requestHeaders,apiBody:K.apiBody,assemblyName:K.assemblyName,className:K.className,methodName:K.methodName,paramJson:K.paramJson,shellCommand:K.shellCommand,apiTimeout:K.apiTimeout,isActive:K.isActive,retryCount:K.retryCount,retryInterval:K.retryInterval};K.jobName&&K.jobGroup&&"编辑作业"===F.value?(yield function(a){return e(this,null,function*(){return yield l.put("/api/quartz/UpdateJob",a)})}(K.jobName,K.jobGroup),o.success("作业更新成功")):(yield function(a){return e(this,null,function*(){return yield l.post("/api/quartz/AddJob",a)})}(a),o.success("作业创建成功")),M.value=!1,Y()}catch(r){if(r.errorFields)return;const e=(null==(t=null==(a=r.response)?void 0:a.data)?void 0:t.message)||r.message||("编辑作业"===F.value?"作业更新失败":"作业创建失败");o.error(e),console.error("保存作业失败:",r)}finally{U.value=!1}}),re=a=>e(null,null,function*(){try{yield function(a,t){return e(this,null,function*(){return yield l.delete("/api/quartz/DeleteJob",{params:{jobName:a,jobGroup:t}})})}(a.jobName,a.jobGroup),o.success("作业删除成功"),Y()}catch(t){o.error("作业删除失败"),console.error("删除作业失败:",t)}}),ue=l=>e(null,null,function*(){try{yield S(l.jobName,l.jobGroup),o.success("作业暂停成功"),Y()}catch(e){o.error("作业暂停失败"),console.error("暂停作业失败:",e)}}),se=a=>e(null,null,function*(){try{yield function(a,t){return e(this,null,function*(){return yield l.post("/api/quartz/ResumeJob",null,{params:{jobName:a,jobGroup:t}})})}(a.jobName,a.jobGroup),o.success("作业恢复成功"),Y()}catch(t){o.error("作业恢复失败"),console.error("恢复作业失败:",t)}}),ne=a=>e(null,null,function*(){try{yield function(a,t){return e(this,null,function*(){return yield l.post("/api/quartz/TriggerJob",null,{params:{jobName:a,jobGroup:t}})})}(a.jobName,a.jobGroup),o.success("作业立即执行成功"),r.success({message:"作业执行通知",description:`作业 ${a.jobName} 已开始执行，请稍后在日志中查看执行结果`})}catch(t){o.error("作业执行失败"),console.error("执行作业失败:",t)}}),ie=()=>{switch(K.jobType){case E.CLASS:return[{type:"input",label:"程序集名称",name:"assemblyName",placeholder:"请输入程序集名称",required:!0},{type:"input",label:"类名",name:"className",placeholder:"请输入类名（包含命名空间）",required:!0},{type:"input",label:"方法名",name:"methodName",placeholder:"请输入方法名",required:!0},{type:"textarea",label:"参数JSON",name:"paramJson",placeholder:"JSON格式的参数",rows:4}];case E.HTTP:return[{type:"input",label:"请求URL",name:"requestUrl",placeholder:"请输入HTTP请求URL",required:!0},{type:"select",label:"请求方法",name:"requestMethod",options:[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"DELETE",value:"DELETE"}]},{type:"textarea",label:"请求头",name:"requestHeaders",placeholder:'JSON格式的请求头，例如: {"Content-Type": "application/json"}',rows:3},{type:"textarea",label:"API请求体",name:"apiBody",placeholder:"请求体内容",rows:4}];case E.SCRIPT:return[{type:"textarea",label:"脚本命令",name:"shellCommand",placeholder:"请输入要执行的脚本命令",rows:4,required:!0}];default:return[]}};return _(()=>{Y()}),(l,r)=>(T(),N(I(b),null,{default:C(()=>[g(I(s),{style:{"margin-bottom":"20px"}},{default:C(()=>[g(I(i),{ref_key:"searchFormRef",ref:$,model:H.value,layout:"inline","label-col":{span:8},"wrapper-col":{span:16},style:{"flex-wrap":"wrap"}},{default:C(()=>[g(I(i).Item,{label:"作业名称",name:"jobName",style:{"margin-bottom":"16px"}},{default:C(()=>[g(I(d),{placeholder:"请输入作业名称",style:{width:"180px"}})]),_:1}),g(I(i).Item,{label:"作业分组",name:"jobGroup",style:{"margin-bottom":"16px"}},{default:C(()=>[g(I(d),{placeholder:"请输入作业分组",style:{width:"180px"}})]),_:1}),g(I(i).Item,{label:"作业状态",name:"status",style:{"margin-bottom":"16px"}},{default:C(()=>[g(I(p),{placeholder:"请选择状态",allowClear:"",style:{width:"120px"}},{default:C(()=>[g(I(p).Option,{value:I(O).Normal},{default:C(()=>[...r[4]||(r[4]=[q("正常",-1)])]),_:1},8,["value"]),g(I(p).Option,{value:I(O).Paused},{default:C(()=>[...r[5]||(r[5]=[q("已暂停",-1)])]),_:1},8,["value"]),g(I(p).Option,{value:I(O).Completed},{default:C(()=>[...r[6]||(r[6]=[q("已完成",-1)])]),_:1},8,["value"]),g(I(p).Option,{value:I(O).Error},{default:C(()=>[...r[7]||(r[7]=[q("错误",-1)])]),_:1},8,["value"]),g(I(p).Option,{value:I(O).Blocked},{default:C(()=>[...r[8]||(r[8]=[q("阻塞",-1)])]),_:1},8,["value"])]),_:1})]),_:1}),g(I(i).Item,{label:"作业类型",name:"jobType",style:{"margin-bottom":"16px"}},{default:C(()=>[g(I(p),{placeholder:"请选择类型",allowClear:"",style:{width:"120px"}},{default:C(()=>[g(I(p).Option,{value:I(E).DLL},{default:C(()=>[...r[9]||(r[9]=[q("DLL",-1)])]),_:1},8,["value"]),g(I(p).Option,{value:I(E).API},{default:C(()=>[...r[10]||(r[10]=[q("API",-1)])]),_:1},8,["value"])]),_:1})]),_:1}),g(I(i).Item,{style:{"margin-bottom":"16px"}},{default:C(()=>[g(I(m),null,{default:C(()=>[g(I(a),{type:"primary",onClick:ee},{default:C(()=>[...r[11]||(r[11]=[q(" 搜索 ",-1)])]),_:1}),g(I(a),{onClick:le},{default:C(()=>[...r[12]||(r[12]=[q(" 重置 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),g(I(s),null,{default:C(()=>[g(I(i).Item,null,{default:C(()=>[g(I(m),{wrap:""},{default:C(()=>[g(I(a),{type:"primary",onClick:ae},{default:C(()=>[...r[13]||(r[13]=[q(" 新增作业 ",-1)])]),_:1})]),_:1})]),_:1}),g(I(n),{columns:W,"data-source":R.value,pagination:X.value,loading:U.value,rowKey:e=>`${e.jobName}-${e.jobGroup}`,onChange:Z,expandable:V,size:"middle",width:"100%",tableLayout:"auto"},{action:C(({record:l})=>[g(I(m),null,{default:C(()=>[g(I(a),{type:"primary",disabled:U.value,onClick:e=>te(l)},{default:C(()=>[...r[14]||(r[14]=[q("编辑",-1)])]),_:1},8,["disabled","onClick"]),g(I(a),{danger:"",disabled:U.value,onClick:e=>re(l)},{default:C(()=>[...r[15]||(r[15]=[q("删除",-1)])]),_:1},8,["disabled","onClick"]),l.status===I(O).Normal?(T(),N(I(a),{key:0,disabled:U.value,onClick:a=>{return t=l,e(null,null,function*(){try{yield S(t.jobName,t.jobGroup),o.success("作业暂停成功"),Y()}catch(e){o.error("作业暂停失败"),console.error("暂停作业失败:",e)}});var t}},{default:C(()=>[...r[16]||(r[16]=[q("停止",-1)])]),_:1},8,["disabled","onClick"])):(T(),N(I(a),{key:1,disabled:U.value,onClick:e=>se(l)},{default:C(()=>[...r[17]||(r[17]=[q("恢复",-1)])]),_:1},8,["disabled","onClick"]))]),_:2},1024)]),_:1},8,["data-source","pagination","loading","rowKey"])]),_:1}),g(I(t),{visible:M.value,"onUpdate:visible":r[2]||(r[2]=e=>M.value=e),title:F.value,width:"700px",onCancel:r[3]||(r[3]=e=>M.value=!1)},{footer:C(()=>[g(I(m),null,{default:C(()=>[g(I(a),{onClick:r[1]||(r[1]=e=>M.value=!1)},{default:C(()=>[...r[21]||(r[21]=[q("取消",-1)])]),_:1}),g(I(a),{type:"primary",onClick:oe},{default:C(()=>[...r[22]||(r[22]=[q("保存",-1)])]),_:1})]),_:1})]),default:C(()=>[g(I(i),{ref_key:"formRef",ref:Q,model:K,layout:"vertical","label-col":{span:6},"wrapper-col":{span:18}},{default:C(()=>[g(I(i).Item,{label:"作业名称",name:"jobName",rules:[{required:!0,message:"请输入作业名称"}]},{default:C(()=>[g(I(d),{placeholder:"请输入作业名称"})]),_:1}),g(I(i).Item,{label:"作业分组",name:"jobGroup",rules:[{required:!0,message:"请输入作业分组"}]},{default:C(()=>[g(I(d),{placeholder:"请输入作业分组"})]),_:1}),g(I(i).Item,{label:"作业类型",name:"jobType",rules:[{required:!0,message:"请选择作业类型"}]},{default:C(()=>[g(I(p),{value:K.jobType,"onUpdate:value":r[0]||(r[0]=e=>K.jobType=e),onChange:()=>{}},{default:C(()=>[g(I(p).Option,{value:I(E).DLL},{default:C(()=>[...r[18]||(r[18]=[q("DLL",-1)])]),_:1},8,["value"]),g(I(p).Option,{value:I(E).API},{default:C(()=>[...r[19]||(r[19]=[q("API",-1)])]),_:1},8,["value"])]),_:1},8,["value"])]),_:1}),g(I(i).Item,{label:"Cron表达式",name:"cronExpression",rules:[{required:!0,message:"请输入Cron表达式"}]},{default:C(()=>[g(I(d),{placeholder:"例如: 0 0/1 * * * ? (每分钟执行一次)"})]),_:1}),g(I(i).Item,{label:"描述",name:"description"},{default:C(()=>[g(I(d).TextArea,{placeholder:"请输入作业描述",rows:3})]),_:1}),g(I(i).Item,{label:"API超时(ms)",name:"apiTimeout",rules:[{required:!0,message:"请输入API超时时间"}]},{default:C(()=>[g(I(d),{type:"number",placeholder:"请输入API超时时间，单位毫秒"})]),_:1}),g(I(i).Item,{label:"重试次数",name:"retryCount"},{default:C(()=>[g(I(d),{type:"number",placeholder:"请输入失败重试次数"})]),_:1}),g(I(i).Item,{label:"重试间隔(ms)",name:"retryInterval"},{default:C(()=>[g(I(d),{type:"number",placeholder:"请输入重试间隔时间"})]),_:1}),g(I(i).Item,{label:"是否启用",name:"isActive",valuePropName:"checked"},{default:C(()=>[g(I(c))]),_:1}),g(I(v),null,{default:C(()=>[...r[20]||(r[20]=[q("作业配置详情",-1)])]),_:1}),(T(!0),w(G,null,A(ie(),(e,l)=>(T(),N(I(i).Item,{key:`${e.name}-${l}`,label:e.label,name:e.name,rules:e.required?[{required:!0,message:`请输入${e.label}`}]:[]},{default:C(()=>["input"===e.type?(T(),N(I(d),{key:0,placeholder:e.placeholder},null,8,["placeholder"])):"select"===e.type?(T(),w(G,{key:1},[e.options?(T(),N(I(p),{key:0,value:K[e.name],"onUpdate:value":l=>K[e.name]=l},{default:C(()=>[(T(!0),w(G,null,A(e.options,e=>(T(),N(I(p).Option,{key:e.value,value:e.value},{default:C(()=>[q(L(e.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])):P("",!0)],64)):"textarea"===e.type?(T(),N(I(d).TextArea,{key:2,placeholder:e.placeholder,rows:e.rows||3},null,8,["placeholder","rows"])):P("",!0)]),_:2},1032,["label","name","rules"]))),128))]),_:1},8,["model"])]),_:1},8,["visible","title"])]),_:1}))}}),[["__scopeId","data-v-1e8e92f8"]]);export{J as default};
