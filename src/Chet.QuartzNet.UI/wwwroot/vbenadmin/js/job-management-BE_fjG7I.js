var p=(s,m,x)=>new Promise((y,S)=>{var R=g=>{try{L(x.next(g))}catch(w){S(w)}},P=g=>{try{L(x.throw(g))}catch(w){S(w)}},L=g=>g.done?y(g.value):Promise.resolve(g.value).then(R,P);L((x=x.apply(s,m)).next())});import{c4 as G,a1 as C,cf as Te,c6 as c,cC as we,bu as Ie}from"./bootstrap-SVCeOZ28.js";import{C as ae,T as he}from"./index-Db1AHJZA.js";import{F as d}from"./index-CG0Gh4Nk.js";import N from"./index-CjIxYXl0.js";import b from"./index-7DVKceo9.js";import J from"./index-DSwaa7KP.js";import te from"./index-UEf5IqVJ.js";import qe from"./index-BeztCR3O.js";import{_ as ke}from"./page.vue_vue_type_script_setup_true_lang-_SsIDlol.js";import{T as re}from"./index-Cw3medL3.js";import{a1 as Ae,L as h,P as Ge,E as Pe,aa as Le,ai as A,aj as T,ak as r,p as t,a9 as a,ax as i,f as v,ap as $,F as D,aq as le,an as oe,ay as _e}from"../jse/index-index-Bt_MP_ox.js";import"./index-5xsysK-2.js";import"./shallowequal-j2xGo5Va.js";import"./Trigger-D-n-hQ9O.js";import"./ResizeObserver.es-CDE7jhPe.js";import"./_arrayIncludes-B8uzE354.js";import"./Overflow-q6LdD1Fo.js";import"./BaseInput-C-cebmUA.js";import"./index-DZ3vuuAR.js";import"./colors-BVeuKa_j.js";import"./collapseMotion-DsFm8Fol.js";import"./slide-kLWRC5Vr.js";import"./useRefs-EKjKvWeg.js";import"./responsiveObserve-eHwk_mHu.js";import"./DownOutlined-DBefXIE3.js";import"./useMergedState-CBAWJtdM.js";import"./EyeOutlined-BUVkri0_.js";import"./index-N_sj-4OB.js";import"./index-dxMVc5uO.js";import"./CheckOutlined-DlXS5zDS.js";import"./SearchOutlined-Dn7DwJFZ.js";import"./move-BcK7CKvS.js";import"./index-Ca-wr08B.js";import"./index-4n8nAx6A.js";import"./index-DCzAJCQV.js";import"./Checkbox-BBSJ3_vc.js";import"./FormItemContext-DvLiB2HN.js";import"./index-CZ-cikmv.js";import"./useFlexGapSupport-yeugQDp2.js";import"./statusUtils-ChE8HFYA.js";var f=(s=>(s[s.DLL=0]="DLL",s[s.API=1]="API",s))(f||{}),j=(s=>(s[s.Normal=0]="Normal",s[s.Paused=1]="Paused",s[s.Completed=2]="Completed",s[s.Error=3]="Error",s[s.Blocked=4]="Blocked",s))(j||{});function Se(s){return p(this,null,function*(){return yield G.post("/api/quartz/GetJobs",s)})}function Be(s,m){return p(this,null,function*(){return yield G.get("/api/quartz/GetJob",{params:{jobName:s,jobGroup:m}})})}function Re(s){return p(this,null,function*(){return yield G.post("/api/quartz/AddJob",s)})}function Je(s){return p(this,null,function*(){return yield G.put("/api/quartz/UpdateJob",s)})}function Oe(s,m){return p(this,null,function*(){return yield G.delete("/api/quartz/DeleteJob",{params:{jobName:s,jobGroup:m}})})}function se(s,m){return p(this,null,function*(){return yield G.post("/api/quartz/PauseJob",null,{params:{jobName:s,jobGroup:m}})})}function $e(s,m){return p(this,null,function*(){return yield G.post("/api/quartz/ResumeJob",null,{params:{jobName:s,jobGroup:m}})})}function De(s,m){return p(this,null,function*(){return yield G.post("/api/quartz/TriggerJob",null,{params:{jobName:s,jobGroup:m}})})}const Ue=Ae({__name:"job-management",setup(s){const m={[f.DLL]:{text:"DLL",color:"blue"},[f.API]:{text:"API",color:"green"}},x={[j.Normal]:{text:"正常",status:"success"},[j.Paused]:{text:"已暂停",status:"error"},[j.Completed]:{text:"已完成",status:"default"},[j.Error]:{text:"错误",status:"error"},[j.Blocked]:{text:"阻塞",status:"warning"}},y=h(!1),S=h([]),R=h(0),P=h(1),L=h(10),g=h(),w=h({jobName:"",jobGroup:"",status:void 0,jobType:void 0}),_=h(!1),B=h("新增作业"),n=Ge({jobName:"",jobGroup:"",jobType:f.CLASS,cronExpression:"",description:"",requestUrl:"",requestMethod:"GET",requestHeaders:"",apiBody:"",assemblyName:"",className:"",methodName:"",paramJson:"",shellCommand:"",apiTimeout:3e4,isActive:!0,retryCount:0,retryInterval:0}),O=h(),ne={expandedRowRender:o=>v("div",{style:{padding:"16px",background:"#fafafa"}},[v("div",{style:{marginBottom:"8px"}},[v("strong",null,"描述:")," ",o.description||"-"]),v("div",{style:{marginBottom:"8px"}},[v("strong",null,"创建时间:")," ",o.createTime||"-"]),v("div",{style:{marginBottom:"8px"}},[v("strong",null,"修改时间:")," ",o.updateTime||"-"]),v("div",{style:{display:"flex",gap:"10px",marginTop:"10px"}},[v(C,{type:"link",onClick:()=>ge(o)},"立即执行"),v(C,{type:"link",onClick:()=>je(o)},"暂停")])])},ue=[{title:"作业名称",dataIndex:"jobName",ellipsis:!0},{title:"作业分组",dataIndex:"jobGroup",ellipsis:!0},{title:"作业类型",dataIndex:"jobType",ellipsis:!0,customRender:({record:o})=>{const e=m[o.jobType];return v(re,{color:(e==null?void 0:e.color)||"default"},(e==null?void 0:e.text)||o.jobType||"未知")}},{title:"cron表达式",dataIndex:"cronExpression",ellipsis:!0},{title:"状态",dataIndex:"status",ellipsis:!0,customRender:({record:o})=>{const e=x[o.status];return v(re,{color:(e==null?void 0:e.status)||"default"},(e==null?void 0:e.text)||o.status||"未知")}},{title:"是否启用",dataIndex:"isActive",ellipsis:!0,customRender:({record:o})=>v(te,{checked:o.isActive,disabled:!0})},{title:"上次执行",dataIndex:"lastRunTime",ellipsis:!0},{title:"下次执行",dataIndex:"nextRunTime",ellipsis:!0},{title:"操作",key:"action",width:200,slots:{customRender:"action"}}],ie=Pe(()=>({current:P.value,pageSize:L.value,total:R.value,showSizeChanger:!0,showQuickJumper:!0,showTotal:(o,e)=>`${e[0]}-${e[1]} 共 ${o} 条`,pageSizeOptions:["10","20","50","100"]})),q=()=>p(null,null,function*(){var o,e;y.value=!0;try{const l=yield Se({pageIndex:P.value,pageSize:L.value,jobName:w.value.jobName,jobGroup:w.value.jobGroup,status:w.value.status,jobType:w.value.jobType});S.value=((o=l.data)==null?void 0:o.items)||[],R.value=((e=l.data)==null?void 0:e.totalCount)||0}catch(l){c.error("获取作业列表失败"),console.error("获取作业列表失败:",l)}finally{y.value=!1}}),pe=o=>{P.value=o.current,L.value=o.pageSize,q()},de=()=>p(null,null,function*(){g.value&&(yield g.value.validateFields()),P.value=1,q()}),me=()=>{w.value={jobName:"",jobGroup:"",jobStatus:void 0,jobType:void 0},P.value=1,q()},ce=()=>{B.value="新增作业",Object.assign(n,{jobName:"",jobGroup:"",jobType:f.CLASS,cronExpression:"0 0/1 * * * ?",description:"",requestUrl:"",requestMethod:"GET",requestHeaders:"",apiBody:"",assemblyName:"",className:"",methodName:"",paramJson:"",shellCommand:"",apiTimeout:3e4,isActive:!0,retryCount:0,retryInterval:0}),_.value=!0},be=o=>p(null,null,function*(){var e,l,I,k,U,z,E,M,F,H,V,K,Q,W,X,Y,Z,ee;y.value=!0;try{const u=yield Be(o.jobName,o.jobGroup);B.value="编辑作业";const Ne={jobName:((e=u.result)==null?void 0:e.jobName)||"",jobGroup:((l=u.result)==null?void 0:l.jobGroup)||"",jobType:((I=u.result)==null?void 0:I.jobType)||f.CLASS,cronExpression:((k=u.result)==null?void 0:k.cronExpression)||"",description:((U=u.result)==null?void 0:U.description)||"",requestUrl:((z=u.result)==null?void 0:z.requestUrl)||"",requestMethod:((E=u.result)==null?void 0:E.requestMethod)||"GET",requestHeaders:((M=u.result)==null?void 0:M.requestHeaders)||"",apiBody:((F=u.result)==null?void 0:F.apiBody)||"",assemblyName:((H=u.result)==null?void 0:H.assemblyName)||"",className:((V=u.result)==null?void 0:V.className)||"",methodName:((K=u.result)==null?void 0:K.methodName)||"",paramJson:((Q=u.result)==null?void 0:Q.paramJson)||"",shellCommand:((W=u.result)==null?void 0:W.shellCommand)||"",apiTimeout:((X=u.result)==null?void 0:X.apiTimeout)||3e4,isActive:((Y=u.result)==null?void 0:Y.isActive)!==!1,retryCount:((Z=u.result)==null?void 0:Z.retryCount)||0,retryInterval:((ee=u.result)==null?void 0:ee.retryInterval)||0};Object.assign(n,Ne),_.value=!0}catch(u){c.error("获取作业详情失败"),console.error("获取作业详情失败:",u)}finally{y.value=!1}}),ye=()=>p(null,null,function*(){var o,e;if(O.value)try{yield O.value.validate(),y.value=!0;const l={jobName:n.jobName,jobGroup:n.jobGroup,jobType:n.jobType,cronExpression:n.cronExpression,description:n.description,requestUrl:n.requestUrl,requestMethod:n.requestMethod,requestHeaders:n.requestHeaders,apiBody:n.apiBody,assemblyName:n.assemblyName,className:n.className,methodName:n.methodName,paramJson:n.paramJson,shellCommand:n.shellCommand,apiTimeout:n.apiTimeout,isActive:n.isActive,retryCount:n.retryCount,retryInterval:n.retryInterval};n.jobName&&n.jobGroup&&B.value==="编辑作业"?(yield Je(n.jobName,n.jobGroup,l),c.success("作业更新成功")):(yield Re(l),c.success("作业创建成功")),_.value=!1,q()}catch(l){if(l.errorFields)return;const I=((e=(o=l.response)==null?void 0:o.data)==null?void 0:e.message)||l.message||(B.value==="编辑作业"?"作业更新失败":"作业创建失败");c.error(I),console.error("保存作业失败:",l)}finally{y.value=!1}}),ve=o=>p(null,null,function*(){try{yield Oe(o.jobName,o.jobGroup),c.success("作业删除成功"),q()}catch(e){c.error("作业删除失败"),console.error("删除作业失败:",e)}}),fe=o=>p(null,null,function*(){try{yield se(o.jobName,o.jobGroup),c.success("作业暂停成功"),q()}catch(e){c.error("作业暂停失败"),console.error("暂停作业失败:",e)}}),je=o=>p(null,null,function*(){try{yield se(o.jobName,o.jobGroup),c.success("作业暂停成功"),q()}catch(e){c.error("作业暂停失败"),console.error("暂停作业失败:",e)}}),xe=o=>p(null,null,function*(){try{yield $e(o.jobName,o.jobGroup),c.success("作业恢复成功"),q()}catch(e){c.error("作业恢复失败"),console.error("恢复作业失败:",e)}}),ge=o=>p(null,null,function*(){try{yield De(o.jobName,o.jobGroup),c.success("作业立即执行成功"),we.success({message:"作业执行通知",description:`作业 ${o.jobName} 已开始执行，请稍后在日志中查看执行结果`})}catch(e){c.error("作业执行失败"),console.error("执行作业失败:",e)}}),Ce=()=>{switch(n.jobType){case f.CLASS:return[{type:"input",label:"程序集名称",name:"assemblyName",placeholder:"请输入程序集名称",required:!0},{type:"input",label:"类名",name:"className",placeholder:"请输入类名（包含命名空间）",required:!0},{type:"input",label:"方法名",name:"methodName",placeholder:"请输入方法名",required:!0},{type:"textarea",label:"参数JSON",name:"paramJson",placeholder:"JSON格式的参数",rows:4}];case f.HTTP:return[{type:"input",label:"请求URL",name:"requestUrl",placeholder:"请输入HTTP请求URL",required:!0},{type:"select",label:"请求方法",name:"requestMethod",options:[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"DELETE",value:"DELETE"}]},{type:"textarea",label:"请求头",name:"requestHeaders",placeholder:'JSON格式的请求头，例如: {"Content-Type": "application/json"}',rows:3},{type:"textarea",label:"API请求体",name:"apiBody",placeholder:"请求体内容",rows:4}];case f.SCRIPT:return[{type:"textarea",label:"脚本命令",name:"shellCommand",placeholder:"请输入要执行的脚本命令",rows:4,required:!0}];default:return[]}};return Le(()=>{q()}),(o,e)=>(T(),A(a(ke),null,{default:r(()=>[t(a(ae),{style:{"margin-bottom":"20px"}},{default:r(()=>[t(a(d),{ref_key:"searchFormRef",ref:g,model:w.value,layout:"inline","label-col":{span:8},"wrapper-col":{span:16},style:{"flex-wrap":"wrap"}},{default:r(()=>[t(a(d).Item,{label:"作业名称",name:"jobName",style:{"margin-bottom":"16px"}},{default:r(()=>[t(a(N),{placeholder:"请输入作业名称",style:{width:"180px"}})]),_:1}),t(a(d).Item,{label:"作业分组",name:"jobGroup",style:{"margin-bottom":"16px"}},{default:r(()=>[t(a(N),{placeholder:"请输入作业分组",style:{width:"180px"}})]),_:1}),t(a(d).Item,{label:"作业状态",name:"status",style:{"margin-bottom":"16px"}},{default:r(()=>[t(a(b),{placeholder:"请选择状态",allowClear:"",style:{width:"120px"}},{default:r(()=>[t(a(b).Option,{value:a(j).Normal},{default:r(()=>[...e[4]||(e[4]=[i("正常",-1)])]),_:1},8,["value"]),t(a(b).Option,{value:a(j).Paused},{default:r(()=>[...e[5]||(e[5]=[i("已暂停",-1)])]),_:1},8,["value"]),t(a(b).Option,{value:a(j).Completed},{default:r(()=>[...e[6]||(e[6]=[i("已完成",-1)])]),_:1},8,["value"]),t(a(b).Option,{value:a(j).Error},{default:r(()=>[...e[7]||(e[7]=[i("错误",-1)])]),_:1},8,["value"]),t(a(b).Option,{value:a(j).Blocked},{default:r(()=>[...e[8]||(e[8]=[i("阻塞",-1)])]),_:1},8,["value"])]),_:1})]),_:1}),t(a(d).Item,{label:"作业类型",name:"jobType",style:{"margin-bottom":"16px"}},{default:r(()=>[t(a(b),{placeholder:"请选择类型",allowClear:"",style:{width:"120px"}},{default:r(()=>[t(a(b).Option,{value:a(f).DLL},{default:r(()=>[...e[9]||(e[9]=[i("DLL",-1)])]),_:1},8,["value"]),t(a(b).Option,{value:a(f).API},{default:r(()=>[...e[10]||(e[10]=[i("API",-1)])]),_:1},8,["value"])]),_:1})]),_:1}),t(a(d).Item,{style:{"margin-bottom":"16px"}},{default:r(()=>[t(a(J),null,{default:r(()=>[t(a(C),{type:"primary",onClick:de},{default:r(()=>[...e[11]||(e[11]=[i(" 搜索 ",-1)])]),_:1}),t(a(C),{onClick:me},{default:r(()=>[...e[12]||(e[12]=[i(" 重置 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(a(ae),null,{default:r(()=>[t(a(d).Item,null,{default:r(()=>[t(a(J),{wrap:""},{default:r(()=>[t(a(C),{type:"primary",onClick:ce},{default:r(()=>[...e[13]||(e[13]=[i(" 新增作业 ",-1)])]),_:1})]),_:1})]),_:1}),t(a(he),{columns:ue,"data-source":S.value,pagination:ie.value,loading:y.value,rowKey:l=>`${l.jobName}-${l.jobGroup}`,onChange:pe,expandable:ne,size:"middle",width:"100%",tableLayout:"auto"},{action:r(({record:l})=>[t(a(J),null,{default:r(()=>[t(a(C),{type:"primary",disabled:y.value,onClick:I=>be(l)},{default:r(()=>[...e[14]||(e[14]=[i("编辑",-1)])]),_:1},8,["disabled","onClick"]),t(a(C),{danger:"",disabled:y.value,onClick:I=>ve(l)},{default:r(()=>[...e[15]||(e[15]=[i("删除",-1)])]),_:1},8,["disabled","onClick"]),l.status===a(j).Normal?(T(),A(a(C),{key:0,disabled:y.value,onClick:I=>fe(l)},{default:r(()=>[...e[16]||(e[16]=[i("停止",-1)])]),_:1},8,["disabled","onClick"])):(T(),A(a(C),{key:1,disabled:y.value,onClick:I=>xe(l)},{default:r(()=>[...e[17]||(e[17]=[i("恢复",-1)])]),_:1},8,["disabled","onClick"]))]),_:2},1024)]),_:1},8,["data-source","pagination","loading","rowKey"])]),_:1}),t(a(Te),{visible:_.value,"onUpdate:visible":e[2]||(e[2]=l=>_.value=l),title:B.value,width:"700px",onCancel:e[3]||(e[3]=l=>_.value=!1)},{footer:r(()=>[t(a(J),null,{default:r(()=>[t(a(C),{onClick:e[1]||(e[1]=l=>_.value=!1)},{default:r(()=>[...e[21]||(e[21]=[i("取消",-1)])]),_:1}),t(a(C),{type:"primary",onClick:ye},{default:r(()=>[...e[22]||(e[22]=[i("保存",-1)])]),_:1})]),_:1})]),default:r(()=>[t(a(d),{ref_key:"formRef",ref:O,model:n,layout:"vertical","label-col":{span:6},"wrapper-col":{span:18}},{default:r(()=>[t(a(d).Item,{label:"作业名称",name:"jobName",rules:[{required:!0,message:"请输入作业名称"}]},{default:r(()=>[t(a(N),{placeholder:"请输入作业名称"})]),_:1}),t(a(d).Item,{label:"作业分组",name:"jobGroup",rules:[{required:!0,message:"请输入作业分组"}]},{default:r(()=>[t(a(N),{placeholder:"请输入作业分组"})]),_:1}),t(a(d).Item,{label:"作业类型",name:"jobType",rules:[{required:!0,message:"请选择作业类型"}]},{default:r(()=>[t(a(b),{value:n.jobType,"onUpdate:value":e[0]||(e[0]=l=>n.jobType=l),onChange:()=>{}},{default:r(()=>[t(a(b).Option,{value:a(f).DLL},{default:r(()=>[...e[18]||(e[18]=[i("DLL",-1)])]),_:1},8,["value"]),t(a(b).Option,{value:a(f).API},{default:r(()=>[...e[19]||(e[19]=[i("API",-1)])]),_:1},8,["value"])]),_:1},8,["value"])]),_:1}),t(a(d).Item,{label:"Cron表达式",name:"cronExpression",rules:[{required:!0,message:"请输入Cron表达式"}]},{default:r(()=>[t(a(N),{placeholder:"例如: 0 0/1 * * * ? (每分钟执行一次)"})]),_:1}),t(a(d).Item,{label:"描述",name:"description"},{default:r(()=>[t(a(N).TextArea,{placeholder:"请输入作业描述",rows:3})]),_:1}),t(a(d).Item,{label:"API超时(ms)",name:"apiTimeout",rules:[{required:!0,message:"请输入API超时时间"}]},{default:r(()=>[t(a(N),{type:"number",placeholder:"请输入API超时时间，单位毫秒"})]),_:1}),t(a(d).Item,{label:"重试次数",name:"retryCount"},{default:r(()=>[t(a(N),{type:"number",placeholder:"请输入失败重试次数"})]),_:1}),t(a(d).Item,{label:"重试间隔(ms)",name:"retryInterval"},{default:r(()=>[t(a(N),{type:"number",placeholder:"请输入重试间隔时间"})]),_:1}),t(a(d).Item,{label:"是否启用",name:"isActive",valuePropName:"checked"},{default:r(()=>[t(a(te))]),_:1}),t(a(qe),null,{default:r(()=>[...e[20]||(e[20]=[i("作业配置详情",-1)])]),_:1}),(T(!0),$(D,null,le(Ce(),(l,I)=>(T(),A(a(d).Item,{key:`${l.name}-${I}`,label:l.label,name:l.name,rules:l.required?[{required:!0,message:`请输入${l.label}`}]:[]},{default:r(()=>[l.type==="input"?(T(),A(a(N),{key:0,placeholder:l.placeholder},null,8,["placeholder"])):l.type==="select"?(T(),$(D,{key:1},[l.options?(T(),A(a(b),{key:0,value:n[l.name],"onUpdate:value":k=>n[l.name]=k},{default:r(()=>[(T(!0),$(D,null,le(l.options,k=>(T(),A(a(b).Option,{key:k.value,value:k.value},{default:r(()=>[i(_e(k.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])):oe("",!0)],64)):l.type==="textarea"?(T(),A(a(N).TextArea,{key:2,placeholder:l.placeholder,rows:l.rows||3},null,8,["placeholder","rows"])):oe("",!0)]),_:2},1032,["label","name","rules"]))),128))]),_:1},8,["model"])]),_:1},8,["visible","title"])]),_:1}))}}),Aa=Ie(Ue,[["__scopeId","data-v-1e8e92f8"]]);export{Aa as default};
