var e=(e,t,a)=>new Promise((l,s)=>{var i=e=>{try{r(a.next(e))}catch(t){s(t)}},n=e=>{try{r(a.throw(e))}catch(t){s(t)}},r=e=>e.done?l(e.value):Promise.resolve(e.value).then(i,n);r((a=a.apply(e,t)).next())});import{bW as t,a1 as a,c1 as l,ci as s,bG as i}from"./bootstrap-D6phmYWg.js";import{T as n}from"./index-CuvsxMUe.js";import{M as r}from"./index-DeHWV3DH.js";import{D as o,T as u}from"./index-Bt5bLcL4.js";import{C as d}from"./index-TL0tNVwz.js";import{F as c}from"./index-Df3nyh1t.js";import m from"./index-BfJMUk1H.js";import p from"./index-B6E_bAy-.js";import v from"./index-BHOwOgvc.js";import{T as f}from"./index-HjJIW_AG.js";import{_ as g}from"./page.vue_vue_type_script_setup_true_lang-Ba_TS4NM.js";import{a1 as y,L as x,P as h,E as _,f as b,bG as k,aa as j,ai as O,aj as T,ak as w,p as I,a9 as C,aw as S,aU as P,as as z,an as F,ax as U}from"../jse/index-index-DX7tj1c8.js";import{R as B,C as M}from"./index-B3sI35rj.js";import R from"./index-pZxXt_bY.js";import"./colors-zJ0DQKxk.js";import"./shallowequal-DHvUNYWV.js";import"./Trigger-COxGY89g.js";import"./ResizeObserver.es-C7U_o75s.js";import"./_arrayIncludes-DqeOlflt.js";import"./Overflow-D38XNPs2.js";import"./index-CXridxKt.js";import"./index-DR1QMdAz.js";import"./collapseMotion-BtvIX6f3.js";import"./slide-bORD9Q7A.js";import"./index-ly9NWak3.js";import"./index-BbFwScNz.js";import"./BaseInput-DXgjjXJ5.js";import"./isMobile-VPrdNIIw.js";import"./DownOutlined-DmVdU0KH.js";import"./CheckOutlined-D-yz67ja.js";import"./SearchOutlined-CB1eAQaF.js";import"./move-rJH9PMUo.js";import"./index-Cia9tSkk.js";import"./index-Dp4YK9d8.js";import"./responsiveObserve-C4hkGHli.js";import"./index-CyEhBqvM.js";import"./useMergedState-J774YWf0.js";import"./index-F1Q-j37m.js";import"./Checkbox-Dxz7AaRv.js";import"./FormItemContext-C6ZUKUIz.js";import"./index-CBMVQjP9.js";import"./debounce-CAJjDBL0.js";import"./useRefs-tab-fyFd.js";import"./isPlainObject-C8xwPhfb.js";import"./Col-D6GqbRua.js";import"./useFlexGapSupport-DeG_mIck.js";import"./statusUtils-BIq0f78Z.js";import"./EyeOutlined-CFDiGEnf.js";var J=(e=>(e[e.Pending=0]="Pending",e[e.Sent=1]="Sent",e[e.Failed=2]="Failed",e))(J||{});const q={class:"mb-4 flex items-center justify-between"},N={key:0,class:"notification-detail"},E={class:"detail-header mb-4 rounded-lg p-5"},G={class:"mb-4 flex flex-wrap items-center justify-between gap-3"},$={class:"mt-3 grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-3"},L={class:"info-item flex items-center gap-2 p-2 rounded"},D={class:"text-sm"},H={class:"info-item flex items-center gap-2 p-2 rounded"},K={class:"text-sm"},Q={class:"info-item flex items-center gap-2 p-2 rounded"},W={class:"text-sm"},X={class:"info-item flex items-center gap-2 p-2 rounded"},A={class:"text-sm"},V={class:"detail-content space-y-6"},Y={class:"content-section"},Z={class:"content-card info-card rounded-lg p-4"},ee=["innerHTML"],te={key:0,class:"content-section"},ae={class:"content-card error-card rounded-lg p-4"},le={class:"code-block word-break-break-word m-0 whitespace-pre-wrap text-sm"},se={class:"mt-6 flex justify-end"},ie=i(y({__name:"notification",setup(i){const y={[J.Pending]:{text:"待发送",status:"default"},[J.Sent]:{text:"发送成功",status:"success"},[J.Failed]:{text:"发送失败",status:"error"}},ie=x(!1),ne=x([]),re=x(0),oe=x(1),ue=x(10),de=x(!1),ce=x("通知详情"),me=x(null),pe=x(),ve=x({status:void 0,triggeredBy:""}),fe=x(""),ge=x(void 0),ye=x(!1),xe=x("通知配置"),he=h({token:"",channel:"wechat",template:"html",topic:"",enable:!1,strategy:{notifyOnJobSuccess:!1,notifyOnJobFailure:!0,notifyOnSchedulerError:!0}}),_e=x(),be=_(()=>[{title:"通知标题",dataIndex:"title",ellipsis:!0},{title:"触发来源",dataIndex:"triggeredBy",ellipsis:!0},{title:"状态",dataIndex:"status",ellipsis:!0,customRender:({record:e})=>{const t=y[e.status];return{children:b(n,{color:(null==t?void 0:t.status)||"default"},(null==t?void 0:t.text)||e.status||"未知")}}},{title:"发送时间",dataIndex:"sendTime",ellipsis:!0,sorter:!0,sortOrder:"sendTime"===fe.value?ge.value:void 0,customRender:({record:e})=>({children:e.sendTime?k(e.sendTime):"-"})},{title:"耗时(ms)",dataIndex:"duration",ellipsis:!0,sorter:!0,sortOrder:"duration"===fe.value?ge.value:void 0},{title:"创建时间",dataIndex:"createTime",ellipsis:!0,sorter:!0,sortOrder:"createTime"===fe.value?ge.value:void 0,customRender:({record:e})=>({children:e.createTime?k(e.createTime):"-"})},{title:"操作",key:"action",width:80,fixed:"right",customRender:({record:e})=>{const t=b(r.Item,{onClick:()=>Pe(e)},"详情"),l=b(r.Item,{onClick:()=>ze(e),danger:!0},"删除"),s=b(r,null,[t,l]),i=b(a,{type:"primary",disabled:ie.value},"操作");return{children:b(o,{trigger:["click"],overlay:s},()=>i)}}}]),ke=_(()=>({current:oe.value,pageSize:ue.value,total:re.value,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`${t[0]}-${t[1]} 共 ${e} 条`,pageSizeOptions:["10","20","50","100"]})),je=(e,t,a)=>{void 0!==e.current&&(oe.value=e.current),void 0!==e.pageSize&&(ue.value=e.pageSize),void 0!==a.field&&(fe.value=a.field,ge.value="ascend"===a.order?"ascend":"descend"===a.order?"descend":void 0),Oe()},Oe=()=>e(null,null,function*(){var a,l,i;ie.value=!0;try{const s=yield(i={pageIndex:oe.value,pageSize:ue.value,status:ve.value.status,triggeredBy:ve.value.triggeredBy,sortBy:fe.value,sortOrder:ge.value},e(null,null,function*(){return yield t.post("/api/quartz/GetNotifications",i)}));ne.value=(null==(a=s.data)?void 0:a.items)||[],re.value=(null==(l=s.data)?void 0:l.totalCount)||0}catch(n){s.error("获取通知列表失败")}finally{ie.value=!1}}),Te=()=>e(null,null,function*(){pe.value&&(yield pe.value.validateFields()),oe.value=1,Oe()}),we=()=>{ve.value={status:void 0,triggeredBy:""},oe.value=1,Oe()},Ie=()=>e(null,null,function*(){try{const a=yield e(null,null,function*(){return yield t.get("/api/quartz/GetPushPlusConfig")});Object.assign(he,a.data),ye.value=!0}catch(a){s.error("获取配置失败")}}),Ce=()=>e(null,null,function*(){var a;if(_e.value)try{yield _e.value.validateFields(),ie.value=!0;const l=yield(a=he,e(null,null,function*(){return yield t.post("/api/quartz/SavePushPlusConfig",a)}));l.success?(s.success("配置保存成功"),ye.value=!1):s.error(l.message||"配置保存失败")}catch(l){if(l.errorFields)return;const e=l.message||"配置保存失败";s.error(e)}finally{ie.value=!1}}),Se=()=>e(null,null,function*(){try{ie.value=!0;const a=yield e(null,null,function*(){return yield t.post("/api/quartz/SendTestNotification")});a.success?(s.success("测试通知发送成功"),Oe()):s.error(a.message||"测试通知发送失败")}catch(a){s.error("测试通知发送失败")}finally{ie.value=!1}}),Pe=e=>{me.value=e,de.value=!0},ze=a=>{l.confirm({title:"确认删除",content:"确定要删除这条通知吗？此操作不可恢复。",okText:"确定",okType:"danger",cancelText:"取消",onOk(){return e(this,null,function*(){try{const i=yield(l=a.notificationId,e(null,null,function*(){return yield t.delete("/api/quartz/DeleteNotification",{params:{notificationId:l}})}));i.success?(s.success("通知删除成功"),Oe()):s.error(i.message||"通知删除失败")}catch(i){s.error("通知删除失败")}var l})}})},Fe=()=>{l.confirm({title:"确认清空",content:"确定要清空所有符合条件的通知吗？此操作不可恢复。",okText:"确定",okType:"danger",cancelText:"取消",onOk(){return e(this,null,function*(){try{const l=yield(a={pageIndex:1,pageSize:1,status:ve.value.status,triggeredBy:ve.value.triggeredBy},e(null,null,function*(){return yield t.post("/api/quartz/ClearNotifications",a)}));l.success?(s.success("通知清空成功"),Oe()):s.error(l.message||"通知清空失败")}catch(l){s.error("通知清空失败")}var a})}})};return j(()=>{Oe()}),(e,t)=>(T(),O(C(g),{"auto-content-height":""},{default:w(()=>[I(C(d),{class:"mb-4"},{default:w(()=>[I(C(c),{ref_key:"searchFormRef",ref:pe,model:ve.value,layout:"horizontal","label-align":"right"},{default:w(()=>[I(C(B),{gutter:16},{default:w(()=>[I(C(M),{xs:24,sm:12,md:12,lg:8,xl:6,xxl:4},{default:w(()=>[I(C(c).Item,{label:"通知状态",name:"status"},{default:w(()=>[I(C(m),{value:ve.value.status,"onUpdate:value":t[0]||(t[0]=e=>ve.value.status=e),placeholder:"请选择状态",allowClear:""},{default:w(()=>[I(C(m).Option,{value:C(J).Pending},{default:w(()=>[...t[15]||(t[15]=[S("待发送",-1)])]),_:1},8,["value"]),I(C(m).Option,{value:C(J).Sent},{default:w(()=>[...t[16]||(t[16]=[S("发送成功",-1)])]),_:1},8,["value"]),I(C(m).Option,{value:C(J).Failed},{default:w(()=>[...t[17]||(t[17]=[S("发送失败",-1)])]),_:1},8,["value"])]),_:1},8,["value"])]),_:1})]),_:1}),I(C(M),{xs:24,sm:12,md:12,lg:8,xl:6,xxl:6},{default:w(()=>[I(C(c).Item,{label:"触发来源",name:"triggeredBy"},{default:w(()=>[I(C(p),{value:ve.value.triggeredBy,"onUpdate:value":t[1]||(t[1]=e=>ve.value.triggeredBy=e),placeholder:"请输入触发来源"},null,8,["value"])]),_:1})]),_:1}),I(C(M),{xs:24,sm:24,md:24,lg:8,xl:12,xxl:14,class:"text-right"},{default:w(()=>[I(C(v),null,{default:w(()=>[I(C(a),{type:"primary",onClick:Te},{default:w(()=>[...t[18]||(t[18]=[S("搜索",-1)])]),_:1}),I(C(a),{onClick:we},{default:w(()=>[...t[19]||(t[19]=[S("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),I(C(d),null,{default:w(()=>[P("div",q,[I(C(v),null,{default:w(()=>[I(C(a),{type:"primary",onClick:Ie},{default:w(()=>[...t[20]||(t[20]=[S("通知配置",-1)])]),_:1}),I(C(a),{type:"default",onClick:Se},{default:w(()=>[...t[21]||(t[21]=[S("发送测试通知",-1)])]),_:1})]),_:1}),I(C(v),null,{default:w(()=>[I(C(a),{danger:"",onClick:Fe},{default:w(()=>[...t[22]||(t[22]=[S("清空",-1)])]),_:1})]),_:1})]),I(C(u),{columns:be.value,"data-source":ne.value,pagination:ke.value,loading:ie.value,rowKey:e=>e.notificationId,onChange:je,size:"middle",scroll:{x:"max-content"}},null,8,["columns","data-source","pagination","loading","rowKey"])]),_:1}),I(C(l),{open:ye.value,"onUpdate:open":t[11]||(t[11]=e=>ye.value=e),title:xe.value,width:"800px","body-style":{padding:"24px"},destroyOnClose:"",onCancel:t[12]||(t[12]=e=>ye.value=!1)},{footer:w(()=>[I(C(v),null,{default:w(()=>[I(C(a),{onClick:t[10]||(t[10]=e=>ye.value=!1)},{default:w(()=>[...t[31]||(t[31]=[S("取消",-1)])]),_:1}),I(C(a),{type:"primary",onClick:Ce},{default:w(()=>[...t[32]||(t[32]=[S("保存",-1)])]),_:1})]),_:1})]),default:w(()=>[I(C(c),{ref_key:"formRef",ref:_e,model:he,layout:"horizontal","label-col":{span:6},"wrapper-col":{span:18},"label-align":"right"},{default:w(()=>[I(C(B),{gutter:16},{default:w(()=>[I(C(M),{xs:24,sm:24,md:24},{default:w(()=>[I(C(c).Item,{label:"是否启用",name:"enable",valuePropName:"checked"},{default:w(()=>[I(C(R),{checked:he.enable,"onUpdate:checked":t[2]||(t[2]=e=>he.enable=e)},null,8,["checked"])]),_:1})]),_:1}),I(C(M),{xs:24,sm:24,md:24},{default:w(()=>[I(C(c).Item,{label:"Token",name:"token",rules:[{required:he.enable,message:"请输入PushPlus Token"}]},{default:w(()=>[I(C(p),{value:he.token,"onUpdate:value":t[3]||(t[3]=e=>he.token=e),placeholder:"请输入PushPlus Token"},null,8,["value"])]),_:1},8,["rules"])]),_:1}),I(C(M),{xs:24,sm:24,md:24},{default:w(()=>[I(C(c).Item,{label:"推送渠道",name:"channel"},{default:w(()=>[I(C(m),{value:he.channel,"onUpdate:value":t[4]||(t[4]=e=>he.channel=e)},{default:w(()=>[I(C(m).Option,{value:"wechat"},{default:w(()=>[...t[23]||(t[23]=[S("微信",-1)])]),_:1}),I(C(m).Option,{value:"cp"},{default:w(()=>[...t[24]||(t[24]=[S("企业微信",-1)])]),_:1}),I(C(m).Option,{value:"webhook"},{default:w(()=>[...t[25]||(t[25]=[S("钉钉",-1)])]),_:1}),I(C(m).Option,{value:"mail"},{default:w(()=>[...t[26]||(t[26]=[S("邮件",-1)])]),_:1}),I(C(m).Option,{value:"sms"},{default:w(()=>[...t[27]||(t[27]=[S("短信",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),I(C(M),{xs:24,sm:24,md:24},{default:w(()=>[I(C(c).Item,{label:"消息模板",name:"template"},{default:w(()=>[I(C(m),{value:he.template,"onUpdate:value":t[5]||(t[5]=e=>he.template=e)},{default:w(()=>[I(C(m).Option,{value:"html"},{default:w(()=>[...t[28]||(t[28]=[S("HTML",-1)])]),_:1}),I(C(m).Option,{value:"text"},{default:w(()=>[...t[29]||(t[29]=[S("TEXT",-1)])]),_:1}),I(C(m).Option,{value:"markdown"},{default:w(()=>[...t[30]||(t[30]=[S("Markdown",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),I(C(M),{xs:24,sm:24,md:24},{default:w(()=>[I(C(c).Item,{label:"主题",name:"topic"},{default:w(()=>[I(C(p),{value:he.topic,"onUpdate:value":t[6]||(t[6]=e=>he.topic=e),placeholder:"请输入主题（可选）"},null,8,["value"])]),_:1})]),_:1}),I(C(M),{xs:24,sm:24,md:24},{default:w(()=>[I(C(c).Item,{label:"通知策略",class:"mt-4"},{default:w(()=>[I(C(c).Item,{label:"作业成功时发送",name:"strategy.notifyOnJobSuccess",valuePropName:"checked"},{default:w(()=>[I(C(R),{checked:he.strategy.notifyOnJobSuccess,"onUpdate:checked":t[7]||(t[7]=e=>he.strategy.notifyOnJobSuccess=e)},null,8,["checked"])]),_:1}),I(C(c).Item,{label:"作业失败时发送",name:"strategy.notifyOnJobFailure",valuePropName:"checked"},{default:w(()=>[I(C(R),{checked:he.strategy.notifyOnJobFailure,"onUpdate:checked":t[8]||(t[8]=e=>he.strategy.notifyOnJobFailure=e)},null,8,["checked"])]),_:1}),I(C(c).Item,{label:"调度器异常时发送",name:"strategy.notifyOnSchedulerError",valuePropName:"checked"},{default:w(()=>[I(C(R),{checked:he.strategy.notifyOnSchedulerError,"onUpdate:checked":t[9]||(t[9]=e=>he.strategy.notifyOnSchedulerError=e)},null,8,["checked"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"]),I(C(l),{open:de.value,"onUpdate:open":t[14]||(t[14]=e=>de.value=e),title:ce.value,width:"80%","max-width":1200,footer:null,destroyOnClose:!0},{default:w(()=>[me.value?(T(),z("div",N,[P("div",E,[P("div",G,[I(C(f).Title,{level:4,class:"m-0 text-ellipsis max-w-[70%]"},{default:w(()=>[S(U(me.value.title),1)]),_:1}),I(C(n),{color:y[me.value.status].status,class:"text-lg px-4 py-1 text-base"},{default:w(()=>[S(U(y[me.value.status].text),1)]),_:1},8,["color"])]),P("div",$,[P("div",L,[t[33]||(t[33]=P("span",{class:"font-semibold text-sm opacity-80"},"触发来源:",-1)),P("span",D,U(me.value.triggeredBy||"-"),1)]),P("div",H,[t[34]||(t[34]=P("span",{class:"font-semibold text-sm opacity-80"},"发送时间:",-1)),P("span",K,U(me.value.sendTime?C(k)(me.value.sendTime):"-"),1)]),P("div",Q,[t[35]||(t[35]=P("span",{class:"font-semibold text-sm opacity-80"},"发送耗时:",-1)),P("span",W,U(me.value.duration?`${me.value.duration} ms`:"0 ms"),1)]),P("div",X,[t[36]||(t[36]=P("span",{class:"font-semibold text-sm opacity-80"},"创建时间:",-1)),P("span",A,U(C(k)(me.value.createTime)),1)])])]),P("div",V,[P("div",Y,[I(C(f).Title,{level:5,class:"mb-3"},{default:w(()=>[...t[37]||(t[37]=[S("通知内容",-1)])]),_:1}),P("div",Z,[P("div",{class:"word-break-break-word text-sm",innerHTML:me.value.content},null,8,ee)])]),me.value.errorMessage?(T(),z("div",te,[I(C(f).Title,{level:5,class:"mb-3"},{default:w(()=>[...t[38]||(t[38]=[S("错误信息",-1)])]),_:1}),P("div",ae,[P("pre",le,U(me.value.errorMessage),1)])])):F("",!0)])])):F("",!0),P("div",se,[I(C(a),{onClick:t[13]||(t[13]=e=>de.value=!1),type:"primary",size:"large",class:"px-6"},{default:w(()=>[...t[39]||(t[39]=[S(" 关闭 ",-1)])]),_:1})])]),_:1},8,["open","title"])]),_:1}))}}),[["__scopeId","data-v-4ea0796d"]]);export{ie as default};
