var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(a,t,s)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s,i=(e,a,t)=>new Promise((s,l)=>{var r=e=>{try{i(t.next(e))}catch(a){l(a)}},o=e=>{try{i(t.throw(e))}catch(a){l(a)}},i=e=>e.done?s(e.value):Promise.resolve(e.value).then(r,o);i((t=t.apply(e,a)).next())});import{bW as d,a1 as n,c1 as u,ci as c,bG as m}from"./bootstrap-D6phmYWg.js";import{T as p}from"./index-CuvsxMUe.js";import{C as v}from"./index-TL0tNVwz.js";import{F as f}from"./index-Df3nyh1t.js";import x from"./index-B6E_bAy-.js";import j from"./index-BfJMUk1H.js";import{D as b}from"./dayjs-eLta2mpb.js";import g from"./index-BHOwOgvc.js";import{T as y}from"./index-Bt5bLcL4.js";import{T as _}from"./index-HjJIW_AG.js";import{_ as w}from"./page.vue_vue_type_script_setup_true_lang-Ba_TS4NM.js";import{a1 as h,L as k,P as T,E as O,f as C,bG as S,ai as R,aj as I,ak as N,p as U,a9 as G,as as z,an as E,aw as P,F as D,aU as F,ax as $}from"../jse/index-index-DX7tj1c8.js";import{R as M,C as J}from"./index-B3sI35rj.js";import"./colors-zJ0DQKxk.js";import"./index-DeHWV3DH.js";import"./shallowequal-DHvUNYWV.js";import"./Trigger-COxGY89g.js";import"./ResizeObserver.es-C7U_o75s.js";import"./_arrayIncludes-DqeOlflt.js";import"./Overflow-D38XNPs2.js";import"./index-CXridxKt.js";import"./index-DR1QMdAz.js";import"./collapseMotion-BtvIX6f3.js";import"./slide-bORD9Q7A.js";import"./useRefs-tab-fyFd.js";import"./responsiveObserve-C4hkGHli.js";import"./isMobile-VPrdNIIw.js";import"./useMergedState-J774YWf0.js";import"./isPlainObject-C8xwPhfb.js";import"./Col-D6GqbRua.js";import"./useFlexGapSupport-DeG_mIck.js";import"./debounce-CAJjDBL0.js";import"./FormItemContext-C6ZUKUIz.js";import"./statusUtils-BIq0f78Z.js";import"./BaseInput-DXgjjXJ5.js";import"./index-CyEhBqvM.js";import"./SearchOutlined-CB1eAQaF.js";import"./EyeOutlined-CFDiGEnf.js";import"./index-BbFwScNz.js";import"./DownOutlined-DmVdU0KH.js";import"./CheckOutlined-D-yz67ja.js";import"./move-rJH9PMUo.js";import"./index-0Vw9gs9X.js";import"./index-ly9NWak3.js";import"./index-Cia9tSkk.js";import"./index-Dp4YK9d8.js";import"./index-F1Q-j37m.js";import"./Checkbox-Dxz7AaRv.js";import"./index-CBMVQjP9.js";var q=(e=>(e[e.RUNNING=0]="RUNNING",e[e.SUCCESS=1]="SUCCESS",e[e.ERROR=2]="ERROR",e))(q||{});const A={class:"mb-4 flex items-center justify-end"},B={key:0,class:"log-detail"},L={class:"detail-header mb-4 rounded-lg p-5"},K={class:"mb-4 flex flex-wrap items-center justify-between gap-3"},Q={class:"mt-3 grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-3"},W={class:"info-item flex items-center gap-2 p-2 rounded"},V={class:"text-sm font-medium"},X={class:"info-item flex items-center gap-2 p-2 rounded"},Y={class:"text-sm"},Z={class:"info-item flex items-center gap-2 p-2 rounded"},H={class:"text-sm"},ee={class:"detail-content space-y-6"},ae={class:"content-section"},te={class:"content-card exec-info-card rounded-lg p-4"},se={class:"code-block word-break-break-word m-0 whitespace-pre-wrap text-sm"},le={key:0,class:"content-section"},re={class:"content-card error-card rounded-lg p-4"},oe={class:"code-block word-break-break-word m-0 whitespace-pre-wrap text-sm"},ie={key:1,class:"content-section"},de={class:"content-card error-card rounded-lg p-4"},ne={class:"code-block word-break-break-word m-0 whitespace-pre-wrap text-sm"},ue={key:2,class:"content-section"},ce={class:"content-card success-card rounded-lg p-4"},me={class:"code-block word-break-break-word m-0 whitespace-pre-wrap text-sm"},pe={key:3,class:"content-section"},ve={class:"content-card info-card rounded-lg p-4"},fe={class:"code-block word-break-break-word m-0 whitespace-pre-wrap text-sm"},xe={class:"mt-6 flex justify-end"},je=m(h({__name:"log",setup(e){const m={[q.SUCCESS]:{text:"成功",status:"success"},[q.ERROR]:{text:"失败",status:"error"},[q.RUNNING]:{text:"运行中",status:"processing"}},h=k(!1),je=k([]),be=k(0),ge=k(1),ye=k(10),_e=k(),we=T({jobName:"",jobGroup:"",status:void 0,startTime:void 0,endTime:void 0}),he=k(!1),ke=k(!1),Te=k("日志详情"),Oe=k(null),Ce=k(""),Se=k(""),Re=O(()=>[{title:"作业名称",dataIndex:"jobName",ellipsis:!0},{title:"作业分组",dataIndex:"jobGroup",ellipsis:!0},{title:"状态",dataIndex:"status",customRender:({record:e})=>{const a=m[e.status];return C(p,{color:a.status},{default:()=>(null==a?void 0:a.text)||"未知"})}},{title:"开始时间",dataIndex:"startTime",ellipsis:!0,sorter:!0,sortOrder:"startTime"===Ce.value?"asc"===Se.value?"ascend":"desc"===Se.value?"descend":void 0:void 0,customRender:({record:e})=>e.startTime?S(e.startTime):"-"},{title:"结束时间",dataIndex:"endTime",ellipsis:!0,sorter:!0,sortOrder:"endTime"===Ce.value?"asc"===Se.value?"ascend":"desc"===Se.value?"descend":void 0:void 0,customRender:({record:e})=>e.endTime?S(e.endTime):"-"},{title:"执行时长(ms)",dataIndex:"duration",ellipsis:!0,sorter:!0,sortOrder:"duration"===Ce.value?"asc"===Se.value?"ascend":"desc"===Se.value?"descend":void 0:void 0},{title:"操作",width:80,key:"action",fixed:"right",slots:{customRender:"action"}}]),Ie=O(()=>({current:ge.value,pageSize:ye.value,total:be.value,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,a)=>`${a[0]}-${a[1]} 共 ${e} 条`,pageSizeOptions:["10","20","50","100"]})),Ne=()=>i(null,null,function*(){h.value=!0;try{const u=yield function(e){return i(this,null,function*(){return d.post("/api/quartz/GetJobLogs",e)})}((e=((e,a)=>{for(var t in a||(a={}))l.call(a,t)&&o(e,t,a[t]);if(s)for(var t of s(a))r.call(a,t)&&o(e,t,a[t]);return e})({},we),n={pageIndex:ge.value||1,pageSize:ye.value||10,sortBy:Ce.value,sortOrder:Se.value},a(e,t(n))));if(u.success)u.data&&u.data.items&&Array.isArray(u.data.items)?(je.value=u.data.items,be.value=u.data.totalCount||0):(je.value=[],be.value=0);else{const e=u.errorCode?`${u.message||"获取日志列表失败"} (错误码: ${u.errorCode})`:u.message||"获取日志列表失败";c.error(e),je.value=[],be.value=0}}catch(u){c.error("object"==typeof u&&null!==u&&"message"in u?String(u.message):"获取日志列表失败"),je.value=[],be.value=0}finally{h.value=!1}var e,n}),Ue=(e,a,t)=>{void 0!==e.current&&(ge.value=e.current),void 0!==e.pageSize&&(ye.value=e.pageSize),void 0!==t.field&&(Ce.value=t.field,Se.value="ascend"===t.order?"asc":"descend"===t.order?"desc":""),Ne()},Ge=()=>i(null,null,function*(){_e.value&&(yield _e.value.validateFields()),ge.value=1,Ne()}),ze=()=>{_e.value&&_e.value.resetFields(),ge.value=1,Ne()},Ee=()=>{u.confirm({title:"确认清空",content:"确定要清空日志吗？此操作不可恢复！",onOk:()=>i(null,null,function*(){try{const e=yield function(){return i(this,arguments,function*(e={}){return yield d.post("/api/quartz/ClearLogs",e)})}({jobName:"",jobGroup:"",status:void 0,startTime:void 0,endTime:void 0});e.success?(c.success("日志清空成功"),yield Ne()):c.error(e.message||"日志清空失败")}catch(e){c.error(e.message||"日志清空失败")}})})};return i(null,null,function*(){yield Ne()}),(e,a)=>(I(),R(G(w),{"auto-content-height":""},{default:N(()=>[U(G(v),{class:"mb-4"},{default:N(()=>[U(G(f),{ref_key:"searchFormRef",ref:_e,model:we,layout:"horizontal","label-align":"right"},{default:N(()=>[U(G(M),{gutter:16},{default:N(()=>[U(G(J),{xs:24,sm:12,md:12,lg:8,xl:4},{default:N(()=>[U(G(f).Item,{label:"作业名称",name:"jobName"},{default:N(()=>[U(G(x),{value:we.jobName,"onUpdate:value":a[0]||(a[0]=e=>we.jobName=e),placeholder:"请输入作业名称"},null,8,["value"])]),_:1})]),_:1}),U(G(J),{xs:24,sm:12,md:12,lg:8,xl:4},{default:N(()=>[U(G(f).Item,{label:"作业分组",name:"jobGroup"},{default:N(()=>[U(G(x),{value:we.jobGroup,"onUpdate:value":a[1]||(a[1]=e=>we.jobGroup=e),placeholder:"请输入作业分组"},null,8,["value"])]),_:1})]),_:1}),U(G(J),{xs:24,sm:12,md:12,lg:8,xl:4},{default:N(()=>[U(G(f).Item,{label:"执行状态",name:"status"},{default:N(()=>[U(G(j),{value:we.status,"onUpdate:value":a[2]||(a[2]=e=>we.status=e),placeholder:"请选择状态",allowClear:""},{default:N(()=>[U(G(j).Option,{value:G(q).SUCCESS},{default:N(()=>[...a[7]||(a[7]=[P("成功",-1)])]),_:1},8,["value"]),U(G(j).Option,{value:G(q).ERROR},{default:N(()=>[...a[8]||(a[8]=[P("失败",-1)])]),_:1},8,["value"]),U(G(j).Option,{value:G(q).RUNNING},{default:N(()=>[...a[9]||(a[9]=[P("运行中",-1)])]),_:1},8,["value"])]),_:1},8,["value"])]),_:1})]),_:1}),U(G(J),{xs:24,sm:12,md:12,lg:8,xl:4},{default:N(()=>[U(G(f).Item,{label:"开始时间",name:"startTime"},{default:N(()=>[U(G(b),{value:we.startTime,"onUpdate:value":a[3]||(a[3]=e=>we.startTime=e),showTime:"",placeholder:"选择开始时间"},null,8,["value"])]),_:1})]),_:1}),U(G(J),{xs:24,sm:12,md:12,lg:8,xl:4},{default:N(()=>[U(G(f).Item,{label:"结束时间",name:"endTime"},{default:N(()=>[U(G(b),{value:we.endTime,"onUpdate:value":a[4]||(a[4]=e=>we.endTime=e),showTime:"",placeholder:"选择结束时间"},null,8,["value"])]),_:1})]),_:1}),he.value?(I(),z(D,{key:0},[],64)):E("",!0),U(G(J),{xs:24,sm:12,md:12,lg:8,xl:4,class:"text-right"},{default:N(()=>[U(G(g),null,{default:N(()=>[U(G(n),{type:"primary",onClick:Ge},{default:N(()=>[...a[10]||(a[10]=[P(" 搜索 ",-1)])]),_:1}),U(G(n),{onClick:ze},{default:N(()=>[...a[11]||(a[11]=[P(" 重置 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),U(G(v),null,{default:N(()=>[F("div",A,[U(G(g),null,{default:N(()=>[U(G(n),{danger:"",onClick:Ee},{default:N(()=>[...a[12]||(a[12]=[P("清空日志",-1)])]),_:1})]),_:1})]),U(G(y),{columns:Re.value,"data-source":je.value,pagination:Ie.value,loading:h.value,rowKey:e=>e.logId,size:"middle",onChange:Ue,scroll:{x:"max-content"}},{action:N(({record:e})=>[U(G(g),{size:"middle"},{default:N(()=>[U(G(n),{type:"primary",onClick:a=>(e=>{try{Oe.value=e,ke.value=!0}catch(a){c.error("显示详情失败")}})(e),disabled:h.value},{default:N(()=>[...a[13]||(a[13]=[P(" 详情 ",-1)])]),_:1},8,["onClick","disabled"])]),_:2},1024)]),_:1},8,["columns","data-source","pagination","loading","rowKey"])]),_:1}),U(G(u),{open:ke.value,"onUpdate:open":a[6]||(a[6]=e=>ke.value=e),title:Te.value,width:"80%","max-width":1200,footer:null,destroyOnClose:!0},{default:N(()=>[Oe.value?(I(),z("div",B,[F("div",L,[F("div",K,[U(G(_).Title,{level:4,class:"m-0 text-ellipsis max-w-[70%]"},{default:N(()=>[P($(Oe.value.jobName)+" - "+$(Oe.value.jobGroup),1)]),_:1}),U(G(p),{color:m[Oe.value.status].status,class:"text-lg px-4 py-1 text-base"},{default:N(()=>[P($(m[Oe.value.status].text),1)]),_:1},8,["color"])]),F("div",Q,[F("div",W,[a[14]||(a[14]=F("span",{class:"font-semibold text-sm opacity-80"},"执行时长:",-1)),F("span",V,$(Oe.value.duration||0)+" ms",1)]),F("div",X,[a[15]||(a[15]=F("span",{class:"font-semibold text-sm opacity-80"},"开始时间:",-1)),F("span",Y,$(G(S)(Oe.value.startTime)),1)]),F("div",Z,[a[16]||(a[16]=F("span",{class:"font-semibold text-sm opacity-80"},"结束时间:",-1)),F("span",H,$(Oe.value.endTime?G(S)(Oe.value.endTime):"-"),1)])])]),F("div",ee,[F("div",ae,[U(G(_).Title,{level:5,class:"mb-3"},{default:N(()=>[...a[17]||(a[17]=[P("执行信息",-1)])]),_:1}),F("div",te,[F("pre",se,$(Oe.value.message||"暂无执行信息"),1)])]),Oe.value.errorMessage?(I(),z("div",le,[U(G(_).Title,{level:5,class:"mb-3"},{default:N(()=>[...a[18]||(a[18]=[P("错误信息",-1)])]),_:1}),F("div",re,[F("pre",oe,$(Oe.value.errorMessage),1)])])):E("",!0),Oe.value.exception?(I(),z("div",ie,[U(G(_).Title,{level:5,class:"mb-3"},{default:N(()=>[...a[19]||(a[19]=[P("异常",-1)])]),_:1}),F("div",de,[F("pre",ne,$(Oe.value.exception),1)])])):E("",!0),Oe.value.result?(I(),z("div",ue,[U(G(_).Title,{level:5,class:"mb-3"},{default:N(()=>[...a[20]||(a[20]=[P("执行结果",-1)])]),_:1}),F("div",ce,[F("pre",me,$("string"==typeof Oe.value.result?Oe.value.result:JSON.stringify(Oe.value.result,null,2)),1)])])):E("",!0),Oe.value.jobData?(I(),z("div",pe,[U(G(_).Title,{level:5,class:"mb-3"},{default:N(()=>[...a[21]||(a[21]=[P("作业数据",-1)])]),_:1}),F("div",ve,[F("pre",fe,$("string"==typeof Oe.value.jobData?Oe.value.jobData:JSON.stringify(Oe.value.jobData,null,2)),1)])])):E("",!0)])])):E("",!0),F("div",xe,[U(G(n),{onClick:a[5]||(a[5]=e=>ke.value=!1),type:"primary",size:"large",class:"px-6"},{default:N(()=>[...a[22]||(a[22]=[P(" 关闭 ",-1)])]),_:1})])]),_:1},8,["open","title"])]),_:1}))}}),[["__scopeId","data-v-dae28e79"]]);export{je as default};
