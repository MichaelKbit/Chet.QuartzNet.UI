var se=Object.defineProperty,le=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var M=(r,m,n)=>m in r?se(r,m,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[m]=n,E=(r,m)=>{for(var n in m||(m={}))re.call(m,n)&&M(r,n,m[n]);if(B)for(var n of B(m))ie.call(m,n)&&M(r,n,m[n]);return r},P=(r,m)=>le(r,oe(m));var w=(r,m,n)=>new Promise((g,f)=>{var x=u=>{try{b(n.next(u))}catch(_){f(_)}},O=u=>{try{b(n.throw(u))}catch(_){f(_)}},b=u=>u.done?g(u.value):Promise.resolve(u.value).then(x,O);b((n=n.apply(r,m)).next())});import{bX as Q,a1 as C,c1 as V,ci as N}from"./bootstrap-BI6yMwYV.js";import{T as A}from"./index-CKIU7yp0.js";import{C as J}from"./index-BqkC0wP_.js";import{F as R}from"./index-B3ROWHVA.js";import q from"./index-D0TAIImZ.js";import D from"./index-D73vWT8x.js";import{D as L}from"./dayjs-CMvrzZ-D.js";import F from"./index-C-duBHaZ.js";import{T as de}from"./index-CpFKkVJi.js";import{T as S}from"./index-B-SKjIVq.js";import{_ as ne}from"./page.vue_vue_type_script_setup_true_lang-BSebuAHK.js";import{a1 as ue,L as v,P as me,E as K,f as pe,bG as $,ai as ve,aj as T,ak as l,p as s,a9 as t,as as j,an as I,aw as p,F as ce,ax as c,aU as o}from"../jse/index-index-krPbfoZw.js";import{R as fe,C as h}from"./index-7mm-AReZ.js";import"./colors-Dc_u8NCw.js";import"./index-CLcvzX_z.js";import"./shallowequal-C1N-RJf8.js";import"./Trigger-DYkoLjj9.js";import"./ResizeObserver.es-CDE7jhPe.js";import"./_arrayIncludes-B8uzE354.js";import"./Overflow-ndT3iCC6.js";import"./index-CFiMXEA9.js";import"./index-DmWSAE-O.js";import"./collapseMotion-DIGTsorP.js";import"./slide-DWm6pLdY.js";import"./useRefs-BGdLO8u8.js";import"./responsiveObserve-BYRxqrxc.js";import"./isMobile-8sZ0LT6r.js";import"./useMergedState-Ck3EcLCl.js";import"./isPlainObject-BixbSTcw.js";import"./Col-BCQOq5KI.js";import"./useFlexGapSupport-CV1cwzly.js";import"./debounce-D3YUwy50.js";import"./FormItemContext-BozvBKlD.js";import"./statusUtils-9q02q--r.js";import"./BaseInput-DCf7DsRk.js";import"./index-CblqEFAb.js";import"./SearchOutlined-Btaf9byK.js";import"./EyeOutlined-DDuwlL6l.js";import"./index-_gRZu-Xf.js";import"./DownOutlined-BK8z6SKv.js";import"./CheckOutlined-Dwfi5IhS.js";import"./move-Cp7kphoB.js";import"./index-CyCYpRi5.js";import"./index-C5IMRVXP.js";import"./index-BRd91W8L.js";import"./index-qqkFJUco.js";import"./index-DhFJybv9.js";import"./Checkbox-B_rPoWhO.js";import"./index-DnKZSMnv.js";var k=(r=>(r[r.RUNNING=0]="RUNNING",r[r.SUCCESS=1]="SUCCESS",r[r.ERROR=2]="ERROR",r))(k||{});function be(r){return w(this,null,function*(){return Q.post("/api/quartz/GetJobLogs",r)})}function ge(){return w(this,arguments,function*(r={}){return yield Q.post("/api/quartz/ClearLogs",r)})}const _e={class:"mb-4 flex items-center justify-end"},ye={key:0,class:"log-detail"},xe={class:"detail-header mb-4 rounded-lg bg-gray-50 p-4"},we={class:"mb-3 flex items-center justify-between"},Te={class:"mt-2 grid grid-cols-1 gap-4 md:grid-cols-3"},ke={class:"flex items-center"},Ce={class:"flex items-center"},Ne={class:"flex items-center"},Re={class:"detail-content"},Se={class:"mb-6"},je={class:"rounded-lg border border-gray-200 bg-gray-50 p-4"},Ie={class:"word-break-break-word m-0 whitespace-pre-wrap text-sm"},he={key:0,class:"mb-6"},Oe={class:"rounded-lg border border-red-200 bg-red-50 p-4"},Ue={class:"word-break-break-word m-0 whitespace-pre-wrap text-sm text-red-800"},Ge={key:1,class:"mb-6"},ze={class:"rounded-lg border border-red-200 bg-red-50 p-4"},De={class:"word-break-break-word m-0 whitespace-pre-wrap text-sm text-red-800"},$e={key:2,class:"mb-6"},Fe={class:"rounded-lg border border-blue-200 bg-blue-50 p-4"},Be={class:"word-break-break-word m-0 whitespace-pre-wrap text-sm"},Me={key:3,class:"mb-6"},Ee={class:"rounded-lg border border-green-200 bg-green-50 p-4"},Pe={class:"word-break-break-word m-0 whitespace-pre-wrap text-sm"},Ve={class:"mt-4 flex justify-end"},Pt=ue({__name:"log",setup(r){const m={[k.SUCCESS]:{text:"成功",status:"success"},[k.ERROR]:{text:"失败",status:"error"},[k.RUNNING]:{text:"运行中",status:"processing"}},n=v(!1),g=v([]),f=v(0),x=v(1),O=v(10),b=v(),u=me({jobName:"",jobGroup:"",status:void 0,startTime:void 0,endTime:void 0}),_=v(!1),z=v(!1),X=v("日志详情"),i=v(null),U=v(""),y=v(""),H=K(()=>[{title:"作业名称",dataIndex:"jobName",ellipsis:!0,fixed:"left",width:300},{title:"作业分组",dataIndex:"jobGroup",ellipsis:!0,fixed:"left",width:300},{title:"状态",dataIndex:"status",customRender:({record:a})=>{const e=m[a.status];return pe(A,{color:e.status},e.text)}},{title:"开始时间",dataIndex:"startTime",ellipsis:!0,sorter:!0,sortOrder:U.value==="startTime"?y.value==="asc"?"ascend":y.value==="desc"?"descend":void 0:void 0,customRender:({record:a})=>a.startTime?$(a.startTime):"-"},{title:"结束时间",dataIndex:"endTime",ellipsis:!0,sorter:!0,sortOrder:U.value==="endTime"?y.value==="asc"?"ascend":y.value==="desc"?"descend":void 0:void 0,customRender:({record:a})=>a.endTime?$(a.endTime):"-"},{title:"执行时长(ms)",dataIndex:"duration",ellipsis:!0,sorter:!0,sortOrder:U.value==="duration"?y.value==="asc"?"ascend":y.value==="desc"?"descend":void 0:void 0},{title:"操作",width:80,key:"action",slots:{customRender:"action"}}]),W=K(()=>({current:x.value,pageSize:O.value,total:f.value,showSizeChanger:!0,showQuickJumper:!0,showTotal:(a,e)=>`${e[0]}-${e[1]} 共 ${a} 条`,pageSizeOptions:["10","20","50","100"]})),G=()=>w(null,null,function*(){n.value=!0;try{const a=yield be(P(E({},u),{pageIndex:x.value||1,pageSize:O.value||10,sortBy:U.value,sortOrder:y.value}));if(console.log("API响应:",a),a.success)a.data&&a.data.items&&Array.isArray(a.data.items)?(g.value=a.data.items,f.value=a.data.totalCount||0,console.log(`成功加载日志列表: ${g.value.length} 条记录，共 ${f.value} 条，总页数：${a.data.totalPages}`)):(console.warn("API响应数据格式不符合预期",a.data),g.value=[],f.value=0);else{const e=a.errorCode?`${a.message||"获取日志列表失败"} (错误码: ${a.errorCode})`:a.message||"获取日志列表失败";N.error(e),g.value=[],f.value=0}}catch(a){console.log("获取日志列表时发生错误:",a),N.error(typeof a=="object"&&a!==null&&"message"in a?String(a.message):"获取日志列表失败"),g.value=[],f.value=0}finally{n.value=!1}}),Y=(a,e,d)=>{a.current!==void 0&&(x.value=a.current),a.pageSize!==void 0&&(O.value=a.pageSize),d.field!==void 0&&(U.value=d.field,y.value=d.order==="ascend"?"asc":d.order==="descend"?"desc":""),G()},Z=()=>w(null,null,function*(){b.value&&(yield b.value.validateFields()),x.value=1,G()}),ee=()=>{b.value&&b.value.resetFields(),x.value=1,G()},te=()=>{V.confirm({title:"确认清空",content:"确定要清空日志吗？此操作不可恢复！",onOk:()=>w(null,null,function*(){try{const a=yield ge({jobName:"",jobGroup:"",status:void 0,startTime:void 0,endTime:void 0});a.success?(N.success("日志清空成功"),yield G()):N.error(a.message||"日志清空失败")}catch(a){console.error("清空日志失败:",a),N.error(a.message||"日志清空失败")}})})},ae=a=>{try{i.value=a,z.value=!0}catch(e){N.error("显示详情失败"),console.log("显示详情失败:",e)}};return w(null,null,function*(){yield G()}),(a,e)=>(T(),ve(t(ne),null,{default:l(()=>[s(t(J),{class:"mb-4"},{default:l(()=>[s(t(R),{ref_key:"searchFormRef",ref:b,model:u,layout:"horizontal","label-col":{span:6},"wrapper-col":{span:18},"label-align":"right"},{default:l(()=>[s(t(fe),{gutter:16},{default:l(()=>[s(t(h),{xs:24,sm:12,md:8,lg:8},{default:l(()=>[s(t(R).Item,{label:"作业名称",name:"jobName"},{default:l(()=>[s(t(q),{value:u.jobName,"onUpdate:value":e[0]||(e[0]=d=>u.jobName=d),placeholder:"请输入作业名称"},null,8,["value"])]),_:1})]),_:1}),s(t(h),{xs:24,sm:12,md:8,lg:8},{default:l(()=>[s(t(R).Item,{label:"作业分组",name:"jobGroup"},{default:l(()=>[s(t(q),{value:u.jobGroup,"onUpdate:value":e[1]||(e[1]=d=>u.jobGroup=d),placeholder:"请输入作业分组"},null,8,["value"])]),_:1})]),_:1}),s(t(h),{xs:24,sm:12,md:8,lg:8},{default:l(()=>[s(t(R).Item,{label:"执行状态",name:"status"},{default:l(()=>[s(t(D),{value:u.status,"onUpdate:value":e[2]||(e[2]=d=>u.status=d),placeholder:"请选择状态",allowClear:""},{default:l(()=>[s(t(D).Option,{value:t(k).SUCCESS},{default:l(()=>[...e[8]||(e[8]=[p("成功",-1)])]),_:1},8,["value"]),s(t(D).Option,{value:t(k).ERROR},{default:l(()=>[...e[9]||(e[9]=[p("失败",-1)])]),_:1},8,["value"]),s(t(D).Option,{value:t(k).RUNNING},{default:l(()=>[...e[10]||(e[10]=[p("运行中",-1)])]),_:1},8,["value"])]),_:1},8,["value"])]),_:1})]),_:1}),_.value?(T(),j(ce,{key:0},[s(t(h),{xs:24,sm:12,md:8,lg:8},{default:l(()=>[s(t(R).Item,{label:"开始时间",name:"startTime"},{default:l(()=>[s(t(L),{value:u.startTime,"onUpdate:value":e[3]||(e[3]=d=>u.startTime=d),showTime:"",placeholder:"选择开始时间"},null,8,["value"])]),_:1})]),_:1}),s(t(h),{xs:24,sm:12,md:8,lg:8},{default:l(()=>[s(t(R).Item,{label:"结束时间",name:"endTime"},{default:l(()=>[s(t(L),{value:u.endTime,"onUpdate:value":e[4]||(e[4]=d=>u.endTime=d),showTime:"",placeholder:"选择结束时间"},null,8,["value"])]),_:1})]),_:1})],64)):I("",!0),s(t(h),{xs:24,sm:24,md:24,lg:24,class:"text-right"},{default:l(()=>[s(t(F),null,{default:l(()=>[s(t(C),{type:"primary",onClick:Z},{default:l(()=>[...e[11]||(e[11]=[p(" 搜索 ",-1)])]),_:1}),s(t(C),{onClick:ee},{default:l(()=>[...e[12]||(e[12]=[p(" 重置 ",-1)])]),_:1}),s(t(C),{type:"link",onClick:e[5]||(e[5]=d=>_.value=!_.value)},{default:l(()=>[p(c(_.value?"收起":"展开"),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),s(t(J),null,{default:l(()=>[o("div",_e,[s(t(F),null,{default:l(()=>[s(t(C),{danger:"",onClick:te},{default:l(()=>[...e[13]||(e[13]=[p("清空日志",-1)])]),_:1})]),_:1})]),s(t(de),{columns:H.value,"data-source":g.value,pagination:W.value,loading:n.value,rowKey:d=>d.logId,size:"middle",onChange:Y,scroll:{x:"max-content"},")":""},{action:l(({record:d})=>[s(t(F),{size:"middle"},{default:l(()=>[s(t(C),{type:"primary",onClick:Je=>ae(d),disabled:n.value},{default:l(()=>[...e[14]||(e[14]=[p(" 详情 ",-1)])]),_:1},8,["onClick","disabled"])]),_:2},1024)]),default:l(()=>[e[15]||(e[15]=p('}"> ',-1))]),_:1},8,["columns","data-source","pagination","loading","rowKey"])]),_:1}),s(t(V),{open:z.value,"onUpdate:open":e[7]||(e[7]=d=>z.value=d),title:X.value,width:"1000px",footer:null,destroyOnClose:!0},{default:l(()=>[i.value?(T(),j("div",ye,[o("div",xe,[o("div",we,[s(t(S).Title,{level:4,class:"m-0"},{default:l(()=>[p(c(i.value.jobName)+" - "+c(i.value.jobGroup),1)]),_:1}),s(t(A),{color:m[i.value.status].status,class:"text-lg"},{default:l(()=>[p(c(m[i.value.status].text),1)]),_:1},8,["color"])]),o("div",Te,[o("div",ke,[e[16]||(e[16]=o("span",{class:"mr-2 font-bold"},"执行时长:",-1)),o("span",null,c(i.value.duration||0)+" ms",1)]),o("div",Ce,[e[17]||(e[17]=o("span",{class:"mr-2 font-bold"},"开始时间:",-1)),o("span",null,c(t($)(i.value.startTime)),1)]),o("div",Ne,[e[18]||(e[18]=o("span",{class:"mr-2 font-bold"},"结束时间:",-1)),o("span",null,c(i.value.endTime?t($)(i.value.endTime):"-"),1)])])]),o("div",Re,[o("div",Se,[s(t(S).Title,{level:5,class:"mb-2"},{default:l(()=>[...e[19]||(e[19]=[p("执行信息",-1)])]),_:1}),o("div",je,[o("pre",Ie,"                "+c(i.value.message||"暂无执行信息")+`
              `,1)])]),i.value.errorMessage?(T(),j("div",he,[s(t(S).Title,{level:5,class:"mb-2"},{default:l(()=>[...e[20]||(e[20]=[p("错误信息",-1)])]),_:1}),o("div",Oe,[o("pre",Ue,"                "+c(i.value.errorMessage)+`
              `,1)])])):I("",!0),i.value.exception?(T(),j("div",Ge,[s(t(S).Title,{level:5,class:"mb-2"},{default:l(()=>[...e[21]||(e[21]=[p("异常",-1)])]),_:1}),o("div",ze,[o("pre",De,"                "+c(i.value.exception)+`
              `,1)])])):I("",!0),i.value.result?(T(),j("div",$e,[s(t(S).Title,{level:5,class:"mb-2"},{default:l(()=>[...e[22]||(e[22]=[p("执行结果",-1)])]),_:1}),o("div",Fe,[o("pre",Be,"                "+c(typeof i.value.result=="string"?i.value.result:JSON.stringify(i.value.result,null,2))+`
              `,1)])])):I("",!0),i.value.jobData?(T(),j("div",Me,[s(t(S).Title,{level:5,class:"mb-2"},{default:l(()=>[...e[23]||(e[23]=[p("作业数据",-1)])]),_:1}),o("div",Ee,[o("pre",Pe,"                "+c(typeof i.value.jobData=="string"?i.value.jobData:JSON.stringify(i.value.jobData,null,2))+`
              `,1)])])):I("",!0)])])):I("",!0),o("div",Ve,[s(t(C),{onClick:e[6]||(e[6]=d=>z.value=!1),type:"primary"},{default:l(()=>[...e[24]||(e[24]=[p("关闭",-1)])]),_:1})])]),_:1},8,["open","title"])]),_:1}))}});export{Pt as default};
